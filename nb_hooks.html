<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Pure IPython facilities to help us inspect, control, and modify cell outputs.">

<title>Notebook/IPython hooks – bridget</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Notebook/IPython hooks – bridget">
<meta property="og:description" content="Pure IPython facilities to help us inspect, control, and modify cell outputs.">
<meta property="og:site_name" content="bridget">
<meta name="twitter:title" content="Notebook/IPython hooks – bridget">
<meta name="twitter:description" content="Pure IPython facilities to help us inspect, control, and modify cell outputs.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">bridget</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./nb.html">Notebook State</a></li><li class="breadcrumb-item"><a href="./nb_hooks.html">Notebook/IPython hooks</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridget</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Core Components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./helpers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jstransform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Javascript import transform</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fasthtml_patching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FastHTML patching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./route_provider.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routes provider</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Bridge</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge_widget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridge widget helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logger.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loggers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridge helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge_plugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridge plugins</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Notebook State</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook objects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_hooks.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Notebook/IPython hooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_state.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook state</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Bridget</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridget</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./details_json.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DetailsJSON</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">JavaScript &amp; Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./javascript_extensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JavaScript &amp; Extensions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples/quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">quickstart.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples/htmx_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HTMX Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">(very) WIP</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./widget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Widget (very WIP)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_outline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TBD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./output_edit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Editable Outputs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anydoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AnyDoc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prompt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prompt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_mcp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TBD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nbdev_rt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">nbdev_rt</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cellspec_from" id="toc-cellspec_from" class="nav-link active" data-scroll-target="#cellspec_from">cellspec_from</a></li>
  <li><a href="#nb-update" id="toc-nb-update" class="nav-link" data-scroll-target="#nb-update">NB update</a></li>
  <li><a href="#cellexecinfo" id="toc-cellexecinfo" class="nav-link" data-scroll-target="#cellexecinfo">CellExecInfo</a>
  <ul class="collapse">
  <li><a href="#get_csi" id="toc-get_csi" class="nav-link" data-scroll-target="#get_csi">get_csi</a></li>
  <li><a href="#get_lastinfo" id="toc-get_lastinfo" class="nav-link" data-scroll-target="#get_lastinfo">get_lastinfo</a></li>
  <li><a href="#get_info" id="toc-get_info" class="nav-link" data-scroll-target="#get_info">get_info</a></li>
  <li><a href="#cellexecinfo-1" id="toc-cellexecinfo-1" class="nav-link" data-scroll-target="#cellexecinfo-1">CellExecInfo</a></li>
  </ul></li>
  <li><a href="#autoid-not-used" id="toc-autoid-not-used" class="nav-link" data-scroll-target="#autoid-not-used">autoid (not used)</a>
  <ul class="collapse">
  <li><a href="#displayid" id="toc-displayid" class="nav-link" data-scroll-target="#displayid">DisplayId</a></li>
  </ul></li>
  <li><a href="#bridged-ipython-display_pub-hook" id="toc-bridged-ipython-display_pub-hook" class="nav-link" data-scroll-target="#bridged-ipython-display_pub-hook">Bridged: IPython display_pub hook</a>
  <ul class="collapse">
  <li><a href="#get_bridged" id="toc-get_bridged" class="nav-link" data-scroll-target="#get_bridged">get_bridged</a></li>
  <li><a href="#bridged" id="toc-bridged" class="nav-link" data-scroll-target="#bridged">Bridged</a></li>
  <li><a href="#set-display_id-with-display-object-metadata" id="toc-set-display_id-with-display-object-metadata" class="nav-link" data-scroll-target="#set-display_id-with-display-object-metadata">set display_id with display object metadata</a></li>
  <li><a href="#set-display_id-with-display-call-metadata" id="toc-set-display_id-with-display-call-metadata" class="nav-link" data-scroll-target="#set-display_id-with-display-call-metadata">set display_id with display call metadata</a></li>
  <li><a href="#multi-objects-display" id="toc-multi-objects-display" class="nav-link" data-scroll-target="#multi-objects-display">Multi objects display</a></li>
  <li><a href="#skip" id="toc-skip" class="nav-link" data-scroll-target="#skip">skip</a></li>
  <li><a href="#bridge_cfg.auto_id" id="toc-bridge_cfg.auto_id" class="nav-link" data-scroll-target="#bridge_cfg.auto_id">bridge_cfg.auto_id</a></li>
  </ul></li>
  <li><a href="#outputcapture" id="toc-outputcapture" class="nav-link" data-scroll-target="#outputcapture">OutputCapture</a></li>
  <li><a href="#capturetransformer" id="toc-capturetransformer" class="nav-link" data-scroll-target="#capturetransformer">CaptureTransformer</a>
  <ul class="collapse">
  <li><a href="#get_capturer" id="toc-get_capturer" class="nav-link" data-scroll-target="#get_capturer">get_capturer</a></li>
  <li><a href="#capturetransformer-1" id="toc-capturetransformer-1" class="nav-link" data-scroll-target="#capturetransformer-1">CaptureTransformer</a></li>
  </ul></li>
  <li><a href="#stop_hooks" id="toc-stop_hooks" class="nav-link" data-scroll-target="#stop_hooks">stop_hooks</a></li>
  <li><a href="#get_nb_from_hooks" id="toc-get_nb_from_hooks" class="nav-link" data-scroll-target="#get_nb_from_hooks">get_nb_from_hooks</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/civvic/bridget/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="nb_hooks.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./nb.html">Notebook State</a></li><li class="breadcrumb-item"><a href="./nb_hooks.html">Notebook/IPython hooks</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Notebook/IPython hooks</h1>
</div>

<div>
  <div class="description">
    Pure IPython facilities to help us inspect, control, and modify cell outputs.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<!-- # Prologue -->
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L49" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="cellspec_from" class="level3">
<h3 class="anchored" data-anchor-id="cellspec_from">cellspec_from</h3>
<blockquote class="blockquote">
<pre><code> cellspec_from (s)</code></pre>
</blockquote>
<div id="654fad65" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nburi, cellid <span class="op">=</span> cellspec_from(<span class="st">'/a/b/d#Y114sZmlsZQ=='</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>nburi, cellid</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>('/a/b/d', 'Y114sZmlsZQ==')</code></pre>
</div>
</div>
<p>VSCode cell id format.</p>
</section>
<section id="nb-update" class="level1">
<h1>NB update</h1>
<div id="e8afef96" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>__nb__ <span class="op">=</span> NB()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="9ff3c039" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nb <span class="op">=</span> NB()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nb.update(cell_id<span class="op">=</span><span class="st">'abc'</span>, source<span class="op">=</span><span class="st">'print(1)'</span>)  <span class="co"># type: ignore</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>test_eq(nb[<span class="dv">0</span>].source, <span class="st">'print(1)'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="bcdadc64" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _update_cell(cell_id, source<span class="op">=</span><span class="va">None</span>, exec_result<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    upd <span class="op">=</span> {<span class="st">'execution_count'</span>: exec_result.execution_count} <span class="cf">if</span> exec_result <span class="cf">else</span> {}</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> source <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>: upd[<span class="st">'source'</span>] <span class="op">=</span> source</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    __nb__.update(cell_id, <span class="op">**</span>upd, outputs<span class="op">=</span>_get_outputs(exec_result))  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cellexecinfo" class="level1">
<h1>CellExecInfo</h1>
<blockquote class="blockquote">
<p>IPython cell execution info and __nb__ updater.</p>
</blockquote>
<p>Simple IPython event callback that captures cell id and source code of last run cell.</p>
<p><strong>NOTE</strong>: in this notebook, __nb__ is <em>NOT</em> a valid notebook state yet. It doesn’t reflect markdown cells or deleted cells or cells order. For a valid, updated in real-time, <code>nbformat</code> compliant notebook state (<a href="https://civvic.github.io/bridget/nb.html#nb"><code>NB</code></a>), see <a href="./nb_state.html">21_nb_state.ipynb</a>.</p>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L135" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_csi" class="level3">
<h3 class="anchored" data-anchor-id="get_csi">get_csi</h3>
<blockquote class="blockquote">
<pre><code> get_csi (start=False)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L132" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_lastinfo" class="level3">
<h3 class="anchored" data-anchor-id="get_lastinfo">get_lastinfo</h3>
<blockquote class="blockquote">
<pre><code> get_lastinfo ()</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L131" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_info" class="level3">
<h3 class="anchored" data-anchor-id="get_info">get_info</h3>
<blockquote class="blockquote">
<pre><code> get_info ()</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L78" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="cellexecinfo-1" class="level3">
<h3 class="anchored" data-anchor-id="cellexecinfo-1">CellExecInfo</h3>
<blockquote class="blockquote">
<pre><code> CellExecInfo (start=False)</code></pre>
</blockquote>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<div id="80c241e3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: csi.stop()  <span class="co"># type: ignore</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span>: <span class="cf">pass</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>csi <span class="op">=</span> get_csi(<span class="va">True</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>test_eq(__cellinfo__, {})</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>test_eq(__lastcellinfo__, <span class="va">None</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="06e3c71b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__cellinfo__))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>test_eq(__cellinfo__.source[:<span class="dv">29</span>], <span class="st">"show(DetailsJSON(__cellinfo__"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__nb__[<span class="dv">0</span>]))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
test_eq(__cellinfo__.source[:29], "show(DetailsJSON(__cellinfo__")
show(DetailsJSON(__nb__[0]))
17</span></span>    </li>
    <li>
<span><span class="n">cell_id</span>: <span class="v string">X35sZmlsZQ==</span></span>    </li>
<details><summary>exec_result
</summary>      <ul>
        <li>
<span><span class="n">result</span>: <span class="v null">None</span></span>        </li>
      </ul>
</details>  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">0</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
test_eq(__cellinfo__.source[:29], "show(DetailsJSON(__cellinfo__")
show(DetailsJSON(__nb__[0]))
17</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X35sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details><summary>outputs
</summary>      <ul></ul>
</details>  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<pre><code>17</code></pre>
</div>
</div>
<div id="9b09061e" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__lastcellinfo__, openall<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>show(__nb__[__lastcellinfo__.cell_id])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
test_eq(__cellinfo__.source[:29], "show(DetailsJSON(__cellinfo__")
show(DetailsJSON(__nb__[0]))
17</span></span>    </li>
    <li>
<span><span class="n">cell_id</span>: <span class="v string">X35sZmlsZQ==</span></span>    </li>
<details open=""><summary>exec_result
</summary>      <ul>
        <li>
<span><span class="n">result</span>: <span class="v number">17</span></span>        </li>
        <li>
<span><span class="n">execution_count</span>: <span class="v number">22</span></span>        </li>
        <li>
<span><span class="n">error_before_exec</span>: <span class="v null">None</span></span>        </li>
        <li>
<span><span class="n">error_in_exec</span>: <span class="v null">None</span></span>        </li>
      </ul>
</details>  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">0</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
test_eq(__cellinfo__.source[:29], "show(DetailsJSON(__cellinfo__")
show(DetailsJSON(__nb__[0]))
17</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X35sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">22</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">17</span></span>                </li>
              </ul>
</details><details open=""><summary>metadata
</summary>              <ul></ul>
</details>          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">22</span></span>    </li>
  </ul>
</details>
</div>
</div>
<p><code>__cellinfo__</code> stores information about <strong>current</strong> cell execution, <code>interactiveshell.ExecutionInfo</code>. <code>__cellinfo__.exec_result</code> stores the result of the cell execution, <code>interactiveshell.ExecutionResult</code>, only valid <strong>after</strong> the cell run.</p>
<div id="a0a1b1c3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(ri <span class="op">:=</span> random.randint(<span class="dv">0</span>, sys.maxsize))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>540056390924159495</code></pre>
</div>
</div>
<div id="6353641c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__cellinfo__))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__lastcellinfo__, openall<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>show(__nb__[__lastcellinfo__.cell_id])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>test_eq(__lastcellinfo__.source, <span class="st">"(ri := random.randint(0, sys.maxsize))"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
show(DetailsJSON(__lastcellinfo__, openall=True))
show(__nb__[__lastcellinfo__.cell_id])
test_eq(__lastcelli…</span></span>    </li>
    <li>
<span><span class="n">cell_id</span>: <span class="v string">X42sZmlsZQ==</span></span>    </li>
<details><summary>exec_result
</summary>      <ul>
        <li>
<span><span class="n">result</span>: <span class="v null">None</span></span>        </li>
      </ul>
</details>  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">source</span>: <span class="v string">(ri := random.randint(0, sys.maxsize))</span></span>    </li>
    <li>
<span><span class="n">cell_id</span>: <span class="v string">X41sZmlsZQ==</span></span>    </li>
<details open=""><summary>exec_result
</summary>      <ul>
        <li>
<span><span class="n">result</span>: <span class="v number">540056390924159495</span></span>        </li>
        <li>
<span><span class="n">execution_count</span>: <span class="v number">24</span></span>        </li>
        <li>
<span><span class="n">error_before_exec</span>: <span class="v null">None</span></span>        </li>
        <li>
<span><span class="n">error_in_exec</span>: <span class="v null">None</span></span>        </li>
      </ul>
</details>  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">2</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">(ri := random.randint(0, sys.maxsize))</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X41sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">24</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">540056390924159495</span></span>                </li>
              </ul>
</details><details open=""><summary>metadata
</summary>              <ul></ul>
</details>          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">24</span></span>    </li>
  </ul>
</details>
</div>
</div>
<div id="74b00db6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(__cellinfo__.cell_id)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>test_eq(__cellinfo__.source[:<span class="dv">27</span>], <span class="st">"print(__cellinfo__.cell_id)"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>test_eq(In[<span class="op">-</span><span class="dv">1</span>][:<span class="dv">27</span>], <span class="st">"print(__cellinfo__.cell_id)"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>(exe_cnt <span class="op">:=</span> <span class="bu">len</span>(In)<span class="op">-</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>X43sZmlsZQ==</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>26</code></pre>
</div>
</div>
<div id="fcbb3e20" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(_, __lastcellinfo__.exec_result.result)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>test_eq(_, __lastcellinfo__.exec_result.result)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>test_eq(__lastcellinfo__.exec_result.result, Out[exe_cnt])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>26 26</code></pre>
</div>
</div>
<div id="55c15296" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>display(<span class="st">'abc'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'abc'</code></pre>
</div>
</div>
<div id="1c7bc297" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(_, __lastcellinfo__.exec_result.result)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="va">None</span>, __lastcellinfo__.exec_result.result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>26 None</code></pre>
</div>
</div>
<div id="fce566a2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'13'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dv">23</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>13</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>23</code></pre>
</div>
</div>
<div id="ca549c63" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(_, __lastcellinfo__.exec_result.result)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="dv">23</span>, __lastcellinfo__.exec_result.result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>23 23</code></pre>
</div>
</div>
<div id="adc780cd" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>csi.stop()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>test_is(__cellinfo__, <span class="va">None</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>test_is(__lastcellinfo__, <span class="va">None</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>__cellinfo__.source</code> corresponds to <code>In[-1]</code> or <code>_ih[-1]</code>.<br>
<code>__lastcellinfo__.exec_result.result</code> corresponds to <code>_</code> or <code>Out[__lastcellinfo__.exec_result.execution_count]</code>.</p>
<p><del>But we don’t want the result of the last cell, we want the result of the current cell. For that, keep reading.</del></p>
<p><strong>Caveat</strong>: the front-end is not required to send the cell id. See <a href="https://nbformat.readthedocs.io/en/latest/format_description.html#cell-ids">nbformat Cell ids</a>, <a href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.core.interactiveshell.html#IPython.core.interactiveshell.InteractiveShell.run_cell">run_cell</a>.<br>
<code>VSCode</code> reports nbformat of newly created notebook as 4.4, but it does send the cell id, though not well formed.<br>
<code>nbclassic</code> does not set the cell ID even if the reported nbformat version is 4.5. Bridget creates one in this case.</p>
<div id="ea61c58b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> __nb__.cells: display(c)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@0
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">0</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
test_eq(__cellinfo__.source[:29], "show(DetailsJSON(__cellinfo__")
show(DetailsJSON(__nb__[0]))
17</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X35sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">22</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">17</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">22</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@1
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">1</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__lastcellinfo__, openall=True))
show(__nb__[__lastcellinfo__.cell_id])</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X36sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">23</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@2
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">2</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">(ri := random.randint(0, sys.maxsize))</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X41sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">24</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">540056390924159495</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">24</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@3
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">3</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">show(DetailsJSON(__cellinfo__))
show(DetailsJSON(__lastcellinfo__, openall=True))
show(__nb__[__lastcellinfo__.cell_id])
test_eq(__lastcelli…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X42sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">25</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@4
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">4</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">print(__cellinfo__.cell_id)
test_eq(__cellinfo__.source[:27], "print(__cellinfo__.cell_id)")
test_eq(In[-1][:27], "print(__cellinfo__.cell_i…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X43sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">26</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">26</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">26</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@5
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">5</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">print(_, __lastcellinfo__.exec_result.result)
test_eq(_, __lastcellinfo__.exec_result.result)
test_eq(__lastcellinfo__.exec_result.result, O…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X44sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">27</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@6
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">6</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">display('abc')</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X45sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">28</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@7
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">7</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">print(_, __lastcellinfo__.exec_result.result)
test_eq(None, __lastcellinfo__.exec_result.result)</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X46sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">29</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@8
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">8</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">print('13')
23</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X50sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">30</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">23</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">30</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@9
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">9</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">print(_, __lastcellinfo__.exec_result.result)
test_eq(23, __lastcellinfo__.exec_result.result)</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X51sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">31</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@10
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">10</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">csi.stop()
test_is(__cellinfo__, None)
test_is(__lastcellinfo__, None)</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">X52sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>  </ul>
</details>
</div>
</div>
</section>
</section>
<section id="autoid-not-used" class="level1">
<h1>autoid (not used)</h1>
<p>Note: <code>autoid</code> here is different from fasthtml <code>fh_cfg['auto_id']</code> option. Here we’re trying to automatically set the <code>id</code> attribute of the wrapper element of a cell output in the front-end. If we can do so, we’ll be able to target especific cell outputs.</p>
<div id="22c2ec84" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>__autoid_scr <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="st">// debugger;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="st">me().attribute('id', 'output-</span><span class="sc">{0}</span><span class="st">').classAdd('bridge');</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="st">setTimeout(el =&gt; </span><span class="sc">{{</span><span class="st"> el.remove(); </span><span class="sc">}}</span><span class="st">, 100, me('#</span><span class="sc">{0}</span><span class="st">'))</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> autoid(idx<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> idx <span class="kw">or</span> new_id()</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Script(__autoid_scr.<span class="bu">format</span>(idx), <span class="bu">id</span><span class="op">=</span>idx), idx</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="5031ae4d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>scr, idx <span class="op">=</span> autoid()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dhdl <span class="op">=</span> DisplayHandle(idx)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>dhdl.display(HTML(<span class="st">'bbbb'</span><span class="op">+</span>to_xml(scr)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
cccc<script id="bcb4f211e-336de341-ec353dce-3dc21ce3">
// debugger;
me().attribute('id', 'output-bcb4f211e-336de341-ec353dce-3dc21ce3').classAdd('bridge');
setTimeout(el => { el.remove(); }, 100, me('#bcb4f211e-336de341-ec353dce-3dc21ce3'))
</script>
</div>
</div>
<p>Inspect “bbbb” output of previous cell, the parent element should have class “bridge” and id.</p>
<div id="6bf8ce7c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dhdl.update(HTML(<span class="st">'cccc'</span><span class="op">+</span>to_xml(scr)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>VSCode wipe out the element when updating the cell. We need to send again the autoid.</p>
<section id="displayid" class="level2">
<h2 class="anchored" data-anchor-id="displayid">DisplayId</h2>
<p>An attempt to provide a IPython display wrapper that automatically handles the display ID to allow us to target especific cells. Not working, for now it’s essentially just IPython display.</p>
<div id="f3d8ee48" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DisplayId(DisplayHandle):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, display_id<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(display_id <span class="kw">or</span> new_id())</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._contents <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._sc <span class="op">=</span> to_xml(autoid(<span class="va">self</span>.display_id)[<span class="dv">0</span>]) <span class="cf">if</span> bridge_cfg.auto_id <span class="cf">else</span> <span class="st">''</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> display(<span class="va">self</span>, obj<span class="op">=</span><span class="st">''</span>, <span class="op">**</span>kwargs):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._contents <span class="op">=</span> <span class="bu">str</span>(obj)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        IDISPLAY(HTML(<span class="va">self</span>._contents <span class="op">+</span> <span class="va">self</span>._sc), display_id<span class="op">=</span><span class="va">self</span>.display_id, <span class="op">**</span>kwargs)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>, obj<span class="op">=</span><span class="st">''</span>, <span class="op">**</span>kwargs):</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        kwargs[<span class="st">'update'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.display(obj, <span class="op">**</span>kwargs)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> contents(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._contents</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="262856d1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dhdl <span class="op">=</span> DisplayId()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dhdl.display(<span class="st">'dddd'</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>test_eq(dhdl.contents(), <span class="st">'dddd'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

</div>
</div>
<div id="7faaf58b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dhdl.update(<span class="st">'eeee'</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>test_eq(dhdl.contents(), <span class="st">'eeee'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="dc9d93b1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dhdl.update()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="bridged-ipython-display_pub-hook" class="level1">
<h1>Bridged: IPython display_pub hook</h1>
<blockquote class="blockquote">
<p><code>display_pub</code> hook for <code>display_id</code> and <code>brd-mark</code><br>
Tag cell outputs with bridge metadata to target them.</p>
</blockquote>
<p>In particular, it will transform every <a href="https://github.com/ipython/ipython/blob/6c8484878fd186dafaf344b8af467e646e91827d/IPython/core/display_functions.py#L85">display message</a> to <a href="https://jupyter-client.readthedocs.io/en/stable/messaging.html#update-display-data">transient</a> if the message has a session metadata id (<code>brd_did</code>). It will set the <code>display_id</code> of each output with that same <code>brd_id</code> value. For HTML display objects, it also marks the DOM parent element in the front-end. With this (session unique) tag, we can easily address specific outputs from Python.</p>
<p>This will be handy to target specific cell outputs when we can capture the notebook state down the road.</p>
<p>NOTE: <code>display_pub</code> hooks are <a href="https://github.com/ipython/ipykernel/blob/8322a7684b004ee95f07b2f86f61e28146a5996d/ipykernel/zmqshell.py#L75">thread dependent</a>. Here we assume we only set the hook from the main thread.</p>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L223" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_bridged" class="level3">
<h3 class="anchored" data-anchor-id="get_bridged">get_bridged</h3>
<blockquote class="blockquote">
<pre><code> get_bridged (start=False)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L160" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="bridged" class="level3">
<h3 class="anchored" data-anchor-id="bridged">Bridged</h3>
<blockquote class="blockquote">
<pre><code> Bridged (start=False)</code></pre>
</blockquote>
<p><em>Augment display messages with bridge stuff.</em></p>
<div id="859ac476" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    get_csi().stop()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    brdd.stop()  <span class="co"># type: ignore</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span>: <span class="cf">pass</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>__nb__ <span class="op">=</span> NB()  <span class="co"># type: ignore</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_id <span class="op">=</span> <span class="va">False</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>brdd <span class="op">=</span> get_bridged(<span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="set-display_id-with-display-object-metadata" class="level3">
<h3 class="anchored" data-anchor-id="set-display_id-with-display-object-metadata">set display_id with display object metadata</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'display_data'</span><span class="fu">,</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="st">"&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;"</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'text/html'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'brd_did'</span><span class="fu">:</span> <span class="er">'b8b568b9a-c02e1576-c3a3c120</span><span class="dv">-167</span><span class="er">cedda'</span><span class="fu">}},</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'display_data'</span><span class="fu">,</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="er">'&lt;div&gt;I\'m</span> <span class="er">marked!...</span> <span class="er">MAAARKED!!&lt;/div&gt;&lt;brd-mark</span> <span class="er">id=</span><span class="st">"b8b568b9a-c02e1576-c3a3c120-167cedda"</span><span class="er">&gt;&lt;/brd-mark&gt;'</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'text/html'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'brd_did'</span><span class="fu">:</span> <span class="er">'b8b568b9a-c02e1576-c3a3c120</span><span class="dv">-167</span><span class="er">cedda'</span><span class="fu">}},</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'b8b568b9a-c02e1576-c3a3c120</span><span class="dv">-167</span><span class="er">cedda'</span><span class="fu">}</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="ba9f244d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>did <span class="op">=</span> new_id()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>did<span class="op">=</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>display(HTML(<span class="st">"&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;"</span>, metadata<span class="op">=</span>{<span class="st">'brd_did'</span>: did}))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>info <span class="op">=</span> __cellinfo__<span class="op">;</span> cell1  <span class="op">=</span> __nb__[info.cell_id]<span class="op">;</span> cell1_copy <span class="op">=</span> cell1.copy()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>test_eq(cell1.dids, [did])  <span class="co"># </span><span class="al">NOTE</span><span class="co">: this is only valid after the `display(...)` call in above line</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>did='b595555a9-c867f02c-47d4b361-005ec7c4'</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>I'm doomed!... DOOOOOMED!!</div>
<brd-mark id="b595555a9-c867f02c-47d4b361-005ec7c4"></brd-mark>
</div>
<div class="cell-output cell-output-display">
<pre><code>21</code></pre>
</div>
</div>
<div id="bcd47b0d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>display(cell1_copy)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cell1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@0
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">0</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">did = new_id()
print(f"{did=}")
display(HTML("&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;", metadata={'brd_did': did}))
info = __cellinfo__; cell1 …</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y120sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;
&lt;brd-mark id="b595555a9-c867f02c-47d4b361-005ec7c4"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'b595555a9-c867f02c-47d4b361-005ec7c4'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@0
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">0</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">did = new_id()
print(f"{did=}")
display(HTML("&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;", metadata={'brd_did': did}))
info = __cellinfo__; cell1 …</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y120sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;
&lt;brd-mark id="b595555a9-c867f02c-47d4b361-005ec7c4"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'b595555a9-c867f02c-47d4b361-005ec7c4'}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">50</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">21</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">50</span></span>    </li>
  </ul>
</details>
</div>
</div>
<p>At cell runtime, current cell can be accesed as <code>__nb__[__cellinfo__.cell_id]</code>; after cell execution, it can be accesed as <code>__nb__[__lastcellinfo__.cell_id]</code>.</p>
<p>Note <a href="https://civvic.github.io/bridget/nb.html#nbcell"><code>NBCell</code></a> instance lifecycle: - Before code execution: an instance is created with <code>source</code> and <code>id</code> - After <a href="https://civvic.github.io/bridget/helpers.html#display"><code>display</code></a> statement: the instance is updated with <code>display_data</code> output - After cell run: the instance is updated with <code>execute_result</code> output</p>
<div id="9d156139" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>test_is(<span class="st">'&lt;div&gt;I</span><span class="ch">\'</span><span class="st">m marked!... MAAARKED!!&lt;/div&gt;'</span> <span class="kw">in</span> cell1.outputs[<span class="dv">0</span>][<span class="st">'data'</span>][<span class="st">'text/html'</span>], <span class="va">True</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>dh <span class="op">=</span> brdd.dhs[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>test_eq(dh.display_id, did)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>For convenience, <a href="https://civvic.github.io/bridget/nb_hooks.html#bridged"><code>Bridged</code></a> stores in <code>dhs</code> the last display handles used.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'update_display_data'</span><span class="fu">,</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="st">"&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;"</span><span class="fu">},</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'b5c00d851</span><span class="dv">-9</span><span class="er">da4a95e</span><span class="dv">-36473</span><span class="er">c24</span><span class="dv">-3</span><span class="er">d04534d'</span><span class="fu">}</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'update_display_data'</span><span class="fu">,</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="er">'&lt;div&gt;I\'m</span> <span class="er">doomed!...</span> <span class="er">DOOOOOMED!!&lt;/div&gt;&lt;brd-mark</span> <span class="er">id=</span><span class="st">"b5c00d851-9da4a95e-36473c24-3d04534d"</span><span class="er">&gt;&lt;/brd-mark&gt;'</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'b5c00d851</span><span class="dv">-9</span><span class="er">da4a95e</span><span class="dv">-36473</span><span class="er">c24</span><span class="dv">-3</span><span class="er">d04534d'</span><span class="fu">}</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="7e5f02bd" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dh.update(HTML(<span class="st">"&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;"</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>cell2 <span class="op">=</span> __nb__[__cellinfo__.cell_id]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>test_is(<span class="bu">hasattr</span>(cell2, <span class="st">'did'</span>), <span class="va">False</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>htmls <span class="op">=</span> vals_at(cell1, <span class="st">'outputs.*.data.text/html'</span>, <span class="va">True</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>test_is(<span class="bu">any</span>(<span class="st">'MAAARKED'</span> <span class="kw">in</span> v <span class="cf">for</span> v <span class="kw">in</span> htmls), <span class="va">False</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>test_is(<span class="bu">any</span>(<span class="st">'DOOOOOMED'</span> <span class="kw">in</span> v <span class="cf">for</span> v <span class="kw">in</span> htmls), <span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="22d0ea46" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>display(cell1)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>cell2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@0
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">0</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">did = new_id()
print(f"{did=}")
display(HTML("&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;", metadata={'brd_did': did}))
info = __cellinfo__; cell1 …</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y120sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;
&lt;brd-mark id="b595555a9-c867f02c-47d4b361-005ec7c4"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'b595555a9-c867f02c-47d4b361-005ec7c4'}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">50</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">21</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">50</span></span>    </li>
  </ul>
</details>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@3
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">3</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">dh.update(HTML("&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;"))
cell2 = __nb__[__cellinfo__.cell_id]
test_is(hasattr(cell2, 'did'), False)
htmls = …</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y126sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul></ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">53</span></span>    </li>
  </ul>
</details>
</div>
</div>
</section>
<section id="set-display_id-with-display-call-metadata" class="level2">
<h2 class="anchored" data-anchor-id="set-display_id-with-display-call-metadata">set display_id with display call metadata</h2>
<blockquote class="blockquote">
<p>i.e., <code>display(..., display_id=True)</code> or <code>display(..., display_id="...")</code></p>
</blockquote>
<div id="3c8bba8d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>dh <span class="op">=</span> display(HTML(<span class="st">"&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;"</span>), display_id<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>cell <span class="op">=</span> __nb__[__cellinfo__.cell_id]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>test_eq(at(cell, <span class="st">'outputs.0.metadata.brd_did'</span>), brdd.dh.display_id)  <span class="co"># type: ignore</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>cell</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>I'm doomed!... DOOOOOMED!!</div>
<brd-mark id="e2ffaa8dc80ef2623bc8eb433633f96a"></brd-mark>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@5
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">5</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">dh = display(HTML("&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;"), display_id=True)
cell = __nb__[__cellinfo__.cell_id]
test_eq(at(cell, 'outputs.0.…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y132sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;
&lt;brd-mark id="e2ffaa8dc80ef2623bc8eb433633f96a"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'e2ffaa8dc80ef2623bc8eb433633f96a'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>  </ul>
</details>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'display_data'</span><span class="fu">,</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="st">"&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;"</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'</span><span class="dv">2307</span><span class="er">db4acc4fda0ba305ffdda518748a'</span><span class="fu">}</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'display_data'</span><span class="fu">,</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="er">.</span>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="er">'&lt;div&gt;I\'m</span> <span class="er">marked!...</span> <span class="er">MAAARKED!!&lt;/div&gt;&lt;brd-mark</span> <span class="er">id=</span><span class="st">"2307db4acc4fda0ba305ffdda518748a"</span><span class="er">&gt;&lt;/brd-mark&gt;'</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'brd_did'</span><span class="fu">:</span> <span class="er">'</span><span class="dv">2307</span><span class="er">db4acc4fda0ba305ffdda518748a'</span><span class="fu">},</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'</span><span class="dv">2307</span><span class="er">db4acc4fda0ba305ffdda518748a'</span><span class="fu">}</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="f959dd66" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>brdd.dh.update(HTML(<span class="st">"&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;"</span>))  <span class="co"># type: ignore</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>cell</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@5
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">5</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">dh = display(HTML("&lt;div&gt;I'm marked!... MAAARKED!!&lt;/div&gt;"), display_id=True)
cell = __nb__[__cellinfo__.cell_id]
test_eq(at(cell, 'outputs.0.…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y132sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;
&lt;brd-mark id="e2ffaa8dc80ef2623bc8eb433633f96a"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'e2ffaa8dc80ef2623bc8eb433633f96a'}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">55</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">{'idx': 5,
 'source': 'dh = display(HTML("&lt;div&gt;I\'m marked!... MAAARKED!!&lt;/div&gt;"), display_id=True)\ncell = __nb__[__cellinfo__.cell_id]\nte…</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;style&gt;details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #2…</span></span>                </li>
                <li>
<span><span class="n">text/markdown</span>: <span class="v string">&gt; code

```json
{
  'idx': 5,
  'source': 'dh = display(HTML("&lt;div&gt;I\'m marked!... MAAARKED!!&lt;/div&gt;"), display_id=True)\ncell = __nb__[__cel…</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">55</span></span>    </li>
  </ul>
</details>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'update_display_data'</span><span class="fu">,</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span> <span class="er">'text/html'</span><span class="fu">:</span> <span class="st">"&lt;div&gt;I'm doomed!... DOOOOOMED!!&lt;/div&gt;"</span><span class="fu">},</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'c3d21633d341d2463f13ef40730e8c4a'</span><span class="fu">}</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="er">'msg_type'</span><span class="fu">:</span> <span class="er">'update_display_data'</span><span class="fu">,</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>        <span class="er">'data'</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/plain'</span><span class="fu">:</span> <span class="er">'&lt;IPython.core.display.HTML</span> <span class="er">object&gt;'</span><span class="fu">,</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>            <span class="er">'text/html'</span><span class="fu">:</span> <span class="er">'&lt;div&gt;I\'m</span> <span class="er">doomed!...</span> <span class="er">DOOOOOMED!!&lt;/div&gt;&lt;brd-mark</span> <span class="er">id=</span><span class="st">"c3d21633d341d2463f13ef40730e8c4a"</span><span class="er">&gt;&lt;/brd-mark&gt;'</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>        <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>        <span class="er">'transient'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'display_id'</span><span class="fu">:</span> <span class="er">'c3d21633d341d2463f13ef40730e8c4a'</span><span class="fu">}</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="er">'metadata'</span><span class="fu">:</span> <span class="fu">{}</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="314999f8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>display(<span class="st">'aaaa'</span>, display_id<span class="op">=</span>new_id())<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
bbbb
<brd-mark id="bdd494422-ccb3bff5-e902c0e7-5824bedb"></brd-mark>
</div>
</div>
<div id="ec825474" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>brdd.dh.update(HTML(<span class="st">"bbbb"</span>))  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="7912c176" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>display(<span class="st">'cccc'</span>, metadata<span class="op">=</span>{<span class="st">'bridge'</span>: {<span class="st">'brd_did'</span>: new_id()}})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
dddd
<brd-mark id="b03100cf8-3046a219-bf66d619-8a2def0d"></brd-mark>
</div>
</div>
<div id="0a15c678" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>brdd.dh.update(HTML(<span class="st">"dddd"</span>))  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="9827bb96" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>display(<span class="st">'eeee'</span>, metadata<span class="op">=</span>{<span class="st">'test/plain'</span>: {<span class="st">'brd_did'</span>: new_id()}})</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>test_eq(__nb__[__cellinfo__.cell_id].outputs[<span class="dv">0</span>].data[<span class="st">'text/plain'</span>], <span class="st">"'eeee'"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>ffff</p>
</div>
</div>
<div id="e2107056" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>brdd.dh.update(Markdown(<span class="st">"ffff"</span>))  <span class="co"># type: ignore</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>test_eq(__nb__[__cellinfo__.cell_id].outputs, [])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="multi-objects-display" class="level2">
<h2 class="anchored" data-anchor-id="multi-objects-display">Multi objects display</h2>
<div id="069fd69c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dh <span class="op">=</span> display(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    HTML(<span class="st">"&lt;div&gt;Multi 1&lt;/div&gt;"</span>), </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    HTML(<span class="st">"&lt;div&gt;Multi 2&lt;/div&gt;"</span>), </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    display_id<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>Multi 1</div>
<brd-mark id="6ff9be5be58ae578558d4b803e5a6b9e"></brd-mark>
</div>
<div class="cell-output cell-output-display">
<div>Multi 3</div>
<brd-mark id="6ff9be5be58ae578558d4b803e5a6b9e"></brd-mark>
</div>
</div>
<div id="2b09397d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>(cell <span class="op">:=</span> __nb__[__lastcellinfo__.cell_id])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@13
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">13</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">dh = display(
    HTML("&lt;div&gt;Multi 1&lt;/div&gt;"), 
    HTML("&lt;div&gt;Multi 2&lt;/div&gt;"), 
    display_id=True)</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y150sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;Multi 1&lt;/div&gt;
&lt;brd-mark id="6ff9be5be58ae578558d4b803e5a6b9e"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': '6ff9be5be58ae578558d4b803e5a6b9e'}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;Multi 2&lt;/div&gt;
&lt;brd-mark id="6ff9be5be58ae578558d4b803e5a6b9e"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': '6ff9be5be58ae578558d4b803e5a6b9e'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">63</span></span>    </li>
  </ul>
</details>
</div>
</div>
<div id="30ce5920" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> dh: dh.update(HTML(<span class="st">"&lt;div&gt;Multi 3&lt;/div&gt;"</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>cell</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@13
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">13</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">dh = display(
    HTML("&lt;div&gt;Multi 1&lt;/div&gt;"), 
    HTML("&lt;div&gt;Multi 2&lt;/div&gt;"), 
    display_id=True)</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y150sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;Multi 1&lt;/div&gt;
&lt;brd-mark id="6ff9be5be58ae578558d4b803e5a6b9e"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': '6ff9be5be58ae578558d4b803e5a6b9e'}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">&lt;div&gt;Multi 3&lt;/div&gt;
&lt;brd-mark id="6ff9be5be58ae578558d4b803e5a6b9e"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': '6ff9be5be58ae578558d4b803e5a6b9e'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">63</span></span>    </li>
  </ul>
</details>
</div>
</div>
<p>When using transient display messages with the <a href="https://civvic.github.io/bridget/helpers.html#display"><code>display</code></a> function, multi objects display is ill-defined.</p>
<p>IPython <a href="https://civvic.github.io/bridget/helpers.html#display"><code>display</code></a> assign the same <code>display_id</code> to each object. The front-end however will handle it differently.</p>
<p><code>VSCode</code> displays all objects but only consider transient the last one.<br>
<code>Lab</code>/<code>Notebook</code> repeats the last object as many times as the number of objects sent.</p>
<div id="935eae6b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    HTML(<span class="st">"&lt;div&gt;Multi 1&lt;/div&gt;"</span>, metadata<span class="op">=</span>{<span class="st">'brd_did'</span>: (did1 <span class="op">:=</span> new_id())}), </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    HTML(<span class="st">"&lt;div&gt;Multi 2&lt;/div&gt;"</span>, metadata<span class="op">=</span>{<span class="st">'brd_did'</span>: (did2 <span class="op">:=</span> new_id())})</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>Multi 1</div>
<brd-mark id="b3108dcf1-3bb81d84-7701973c-1f835c55"></brd-mark>
</div>
<div class="cell-output cell-output-display">
<div>Multi 4</div>
<brd-mark id="bcb98a9f4-21647978-7d4fd474-0206a74a"></brd-mark>
</div>
</div>
<div id="83ab5442" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cell <span class="op">=</span> __nb__[__lastcellinfo__.cell_id]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>test_eq(cell.dids, [did1, did2])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="02184c06" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>dh1, dh2 <span class="op">=</span> brdd.dhs[<span class="op">-</span><span class="dv">2</span>], brdd.dhs[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>test_eq(dh1.display_id, did1)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>test_eq(dh2.display_id, did2)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>dh1.update(HTML(<span class="st">"&lt;div&gt;Multi 3&lt;/div&gt;"</span>))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>dh2.update(HTML(<span class="st">"&lt;div&gt;Multi 4&lt;/div&gt;"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We can sidestep the issue by using specific Bridge metadata.</p>
</section>
<section id="skip" class="level2">
<h2 class="anchored" data-anchor-id="skip">skip</h2>
<div id="c5e611c7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="st">"Skipped"</span>), metadata<span class="op">=</span>{<span class="st">'bridge'</span>: {<span class="st">'skip'</span>: <span class="va">True</span>}})</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>display(<span class="st">"Me too"</span>, JSON({<span class="st">"And me"</span>: <span class="va">True</span>}), metadata<span class="op">=</span>skip())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Skipped</p>
</div>
<div class="cell-output cell-output-display">
<pre><code>'Me too'</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;IPython.core.display.JSON object&gt;</code></pre>
</div>
</div>
<div id="2566aba5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>__nb__[__lastcellinfo__.cell_id]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@19
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">19</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">display(Markdown("Skipped"), metadata={'bridge': {'skip': True}})
display("Me too", JSON({"And me": True}), metadata=skip())</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y162sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.Markdown object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/markdown</span>: <span class="v string">Skipped</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'bridge': {'skip': True}}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">'Me too'</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'bridge': {'skip': True}}</span></span>            </li>
          </ul>
</details><details open=""><summary>2
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.JSON object&gt;</span></span>                </li>
                <li>
<span><span class="n">application/json</span>: <span class="v ">{'And me': True}</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'application/json': {'expanded': False, 'root': 'root'}, 'bridge': {'skip': True}}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">69</span></span>    </li>
  </ul>
</details>
</div>
</div>
<p>Skip tagging all display objects.</p>
<div id="16d91100" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    HTML(<span class="st">"Skipped"</span>, metadata<span class="op">=</span>{<span class="st">'skip'</span>:<span class="va">True</span>, <span class="st">'brd_did'</span>:(did1 <span class="op">:=</span> new_id())}),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    HTML(<span class="st">"Not me"</span>, metadata<span class="op">=</span>{<span class="st">'brd_did'</span>:(did2 <span class="op">:=</span> new_id())}),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
Skipped
</div>
<div class="cell-output cell-output-display">
Not me
<brd-mark id="b55581abb-bb1b69e3-6f11a7e8-f4d20014"></brd-mark>
</div>
</div>
<div id="9bcf73c6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>cell <span class="op">=</span> __nb__[__lastcellinfo__.cell_id]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>test_eq(cell.dids, [did2])</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>cell</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@21
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">21</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">display(
    HTML("Skipped", metadata={'skip':True, 'brd_did':(did1 := new_id())}),
    HTML("Not me", metadata={'brd_did':(did2 := new_id()…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y165sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">Skipped</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'text/html': {'skip': True, 'brd_did': 'b19bbdaeb-1ae6ed40-ce525c18-23d81243'}}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">Not me
&lt;brd-mark id="b55581abb-bb1b69e3-6f11a7e8-f4d20014"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'b55581abb-bb1b69e3-6f11a7e8-f4d20014'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">71</span></span>    </li>
  </ul>
</details>
</div>
</div>
<p>Skip specific display object.</p>
</section>
<section id="bridge_cfg.auto_id" class="level2">
<h2 class="anchored" data-anchor-id="bridge_cfg.auto_id">bridge_cfg.auto_id</h2>
<p>if <code>bridge_cfg.auto_id</code> is True, there’s no need to use bridge metadata. Every supported <a href="https://civvic.github.io/bridget/helpers.html#display"><code>display</code></a>ed object (see <code>_BRDD_MIMES</code>) will receive an auto-generated display id.</p>
<p>Caveat: be aware that VSCode limits the number of transient display ids (1000 last time I checked); not Jupyter, I believe.</p>
<div id="a6ba7b0b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_id <span class="op">=</span> <span class="va">True</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>display(HTML(<span class="st">"&lt;div&gt;I'm auto-id'd--&lt;/div&gt;"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>--as shown above.</div>
<brd-mark id="bcc5680ab-5ba9a878-3c3d84a8-f9f86946"></brd-mark>
</div>
</div>
<div id="012ddd3c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>brdd.dhs[<span class="op">-</span><span class="dv">1</span>].update(HTML(<span class="st">"&lt;div&gt;--as shown above.&lt;/div&gt;"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="d8a79d92" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f"## did</span><span class="ch">\n</span><span class="ss">???"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;IPython.core.display.JSON object&gt;</code></pre>
</div>
</div>
<div id="2b90c42f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dh <span class="op">=</span> brdd.dhs[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>dh.update(HTML(<span class="ss">f"&lt;b&gt;did&lt;/b&gt;: </span><span class="sc">{</span>dh<span class="sc">.</span>display_id<span class="sc">}</span><span class="ss">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cb906a5e" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dh.update(JSON({<span class="st">'did'</span>: dh.display_id}))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2e679821" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dhs <span class="op">=</span> []</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>): </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    display(<span class="ss">f'</span><span class="sc">{</span>i<span class="op">=</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    dhs.append(brdd.dhs[<span class="op">-</span><span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'i+1=1'</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>'i+1=2'</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>'i+1=3'</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>'i+1=4'</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>'i+1=5'</code></pre>
</div>
</div>
<div id="dfd779a5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>): </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    dhs[i].update(<span class="ss">f'</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="op">=</span><span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="58f0de8f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>brdd.dhs.clear()</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>brdd.stop()</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>csi.stop()</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_id <span class="op">=</span> <span class="va">False</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<div id="593eda34" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_msgs(brdd: Bridged):</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> msg <span class="kw">in</span> brdd.msgs.copy():</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> msg.copy()</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># d['parent_header'] = {'...': '...'}</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># d['header'] = {'...': '...'}</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> d[<span class="st">'parent_header'</span>], d[<span class="st">'header'</span>], d[<span class="st">'tracker'</span>], d[<span class="st">'msg_id'</span>]</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> d[<span class="st">'metadata'</span>]: <span class="kw">del</span> d[<span class="st">'metadata'</span>]</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>: <span class="kw">del</span> d[<span class="st">'content'</span>][<span class="st">'data'</span>][<span class="st">'text/plain'</span>]</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>: <span class="cf">pass</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> h <span class="op">:=</span> d[<span class="st">'content'</span>][<span class="st">'data'</span>].get(<span class="st">'text/html'</span>): d[<span class="st">'content'</span>][<span class="st">'data'</span>][<span class="st">'text/html'</span>] <span class="op">=</span> shorten(h, <span class="st">'r'</span>, <span class="dv">120</span>)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>        cprint(d)</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DEBUG(): show_msgs(brdd)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="804c6ffc" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> __nb__.cells: display(c)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="outputcapture" class="level1">
<h1>OutputCapture</h1>
<p>Bridget goal is to control (at least) all HTML output. Bridge can now set metadata of any display message, those that go through display_pub. Bridge captures all <a href="https://civvic.github.io/bridget/helpers.html#display"><code>display</code></a>, direct or FastHTML bridge.<br>
But there’s other way to produce output that doesn’t follow the display_pub path: auto display of cell’s final expression. That goes through another code path, display_hook.<br>
Here Bridget leverage IPython’s own capture mechanism to intercept cell results and redirect to display, a path that Bridge already control.</p>
<p>Bridge just captures cell outputs, not stdout/err (yet)</p>
<div id="b6b12c92" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _transform(lines):</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Input transformer function"</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    cpt <span class="op">=</span> get_capturer()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> lines <span class="kw">or</span> cpt._capturing <span class="kw">or</span> cpt._debugging: <span class="cf">return</span> lines</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> DEBUG(): cpt._lines.append(lines)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lines[<span class="dv">0</span>].startswith(<span class="st">'import debugpy'</span>):</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>        cpt._debugging <span class="op">=</span> <span class="va">True</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lines</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> lines[<span class="dv">0</span>].startswith(<span class="st">'import debugpy;debugpy.listen('</span>): <span class="cf">return</span> lines</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> lines[<span class="dv">0</span>].startswith(<span class="st">'import debugpy</span><span class="ch">\n</span><span class="st">debugpy.debug_this_thread()'</span>): <span class="cf">return</span> lines</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> lines[<span class="dv">0</span>].startswith(<span class="st">'def __jupyter_exec_background__()'</span>): <span class="cf">return</span> lines</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> lines[<span class="dv">0</span>].startswith(<span class="st">'import builtins'</span>) <span class="kw">and</span> lines[<span class="dv">1</span>].startswith(<span class="st">'import ipykernel'</span>): <span class="cf">return</span> lines</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> lines[<span class="dv">0</span>].startswith(<span class="st">'import os as _VSCODE_os'</span>) <span class="kw">and</span> lines[<span class="dv">1</span>].startswith(<span class="st">'_VSCODE_fileList ='</span>): <span class="cf">return</span> lines</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">'get_capturer()(</span><span class="sc">%r</span><span class="st">)</span><span class="ch">\n</span><span class="st">'</span> <span class="op">%</span> <span class="st">''</span>.join(lines)]</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>_transform.has_side_effects <span class="op">=</span> <span class="va">False</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OutputCapture:</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    shell: InteractiveShell</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._active, <span class="va">self</span>.shell <span class="op">=</span> <span class="va">False</span>, get_ipython()  <span class="co"># type: ignore</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> DEBUG(): <span class="va">self</span>._captures <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span> <span class="va">self</span>._lines <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._capturing, <span class="va">self</span>._debugging, <span class="va">self</span>.run_outputs <span class="op">=</span> <span class="va">False</span>, <span class="va">False</span>, []</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.displayhook <span class="op">=</span> CapturingDisplayHook(shell<span class="op">=</span><span class="va">self</span>.shell, outputs<span class="op">=</span><span class="va">self</span>.run_outputs)</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> active(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._active</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> start(<span class="va">self</span>):</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._active: <span class="cf">return</span></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._active <span class="op">=</span> <span class="va">True</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.shell.user_ns[<span class="st">'get_capturer'</span>] <span class="op">=</span> get_capturer</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> DEBUG(): <span class="va">self</span>._captures <span class="op">=</span> deque(maxlen<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shell.input_transformer_manager.line_transforms.append(_transform)</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.shell.input_transformers_post.append(_transform)</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> stop(<span class="va">self</span>):</span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._active: <span class="cf">return</span></span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._active <span class="op">=</span> <span class="va">False</span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># try: shell.input_transformer_manager.line_transforms.remove(_transform)</span></span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>: <span class="va">self</span>.shell.input_transformers_post.remove(_transform)</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">ValueError</span>, <span class="pp">NameError</span>): <span class="cf">pass</span></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__del__</span>(<span class="va">self</span>): <span class="va">self</span>.stop()</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@contextmanager</span></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _capture(<span class="va">self</span>):</span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.run_outputs.clear()</span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>: </span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a>            save_display_hook, sys.displayhook <span class="op">=</span> sys.displayhook, <span class="va">self</span>.displayhook</span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._capturing <span class="op">=</span> <span class="va">True</span></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> CapturedIO(stdout<span class="op">=</span><span class="va">None</span>, stderr<span class="op">=</span><span class="va">None</span>, outputs<span class="op">=</span><span class="va">self</span>.run_outputs)</span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">finally</span>: </span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._capturing <span class="op">=</span> <span class="va">False</span></span>
<span id="cb91-52"><a href="#cb91-52" aria-hidden="true" tabindex="-1"></a>            sys.displayhook <span class="op">=</span> save_display_hook</span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, cell):</span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>        info: AD <span class="op">=</span> <span class="va">self</span>.shell.user_ns.get(<span class="st">'__cellinfo__'</span>)  <span class="co"># type: ignore</span></span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="va">self</span>._capture() <span class="im">as</span> io:</span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.shell.run_cell(cell, cell_id<span class="op">=</span>info.cell_id)</span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> DEBUG(): <span class="va">self</span>._captures.append([cell, io._outputs.copy()])</span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> io._outputs: </span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> <span class="bu">len</span>(io._outputs) <span class="op">&lt;=</span> <span class="dv">1</span>, <span class="st">"Only one output is supported"</span></span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>            info.exec_result.result <span class="op">=</span> io._outputs[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a>            display(io.outputs[<span class="op">-</span><span class="dv">1</span>], metadata<span class="op">=</span>{<span class="st">'bridge'</span>: {<span class="st">'captured'</span>: <span class="va">True</span>}})</span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a>__capturer__ <span class="op">=</span> <span class="va">None</span></span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_capturer(start:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>):</span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> __capturer__</span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a>    get_csi(<span class="va">True</span>)</span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> __capturer__ <span class="kw">is</span> <span class="va">None</span>: __capturer__ <span class="op">=</span> OutputCapture()</span>
<span id="cb91-68"><a href="#cb91-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> start: __capturer__.start()</span>
<span id="cb91-69"><a href="#cb91-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> __capturer__</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="a4549570" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>get_csi().stop()</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>get_bridged().stop()</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>get_capturer().stop()</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_id <span class="op">=</span> <span class="va">True</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>__nb__ <span class="op">=</span> NB()  <span class="co"># type: ignore</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>brdd <span class="op">=</span> get_bridged(<span class="va">True</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>cptr <span class="op">=</span> get_capturer(<span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="17ac583d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">+</span><span class="dv">3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>I was 4, now I'm 44</div>
</div>
</div>
<div id="34b4a36f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>info <span class="op">=</span> __lastcellinfo__</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>test_eq(__nb__[__lastcellinfo__.cell_id].outputs[<span class="dv">0</span>].data, {<span class="st">'text/plain'</span>: <span class="st">'4'</span>})</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(brdd.dhs), <span class="dv">1</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__lastcellinfo__, openall<span class="op">=</span><span class="va">True</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>summary
</summary>  <ul>
    <li>
<span><span class="n">source</span>: <span class="v string">1+3</span></span>    </li>
    <li>
<span><span class="n">cell_id</span>: <span class="v string">Y222sZmlsZQ==</span></span>    </li>
<details open=""><summary>exec_result
</summary>      <ul>
<details open=""><summary>result
</summary>          <ul>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">4</span></span>                </li>
              </ul>
</details><details open=""><summary>metadata
</summary>              <ul></ul>
</details>          </ul>
</details>        <li>
<span><span class="n">execution_count</span>: <span class="v number">85</span></span>        </li>
        <li>
<span><span class="n">error_before_exec</span>: <span class="v null">None</span></span>        </li>
        <li>
<span><span class="n">error_in_exec</span>: <span class="v null">None</span></span>        </li>
      </ul>
</details>  </ul>
</details>
<brd-mark id="bc4743314-1703b8af-012c6759-46fba1e2"></brd-mark>
</div>
</div>
<p><code>__cellinfo__.result</code> has a valid value only <strong>after</strong> the <code>display(...)</code> call. The cell with <code>1+3</code> captures the output and then displays it with <code>display(...)</code>. That occurs after the cell is executed. So, <code>__cellinfo__.result</code> is <code>None</code> during the cell execution. It’s only possible to get the output after the cell has run.</p>
<div id="aa74818d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>HTML(<span class="st">'&lt;div&gt;asdf&lt;/div&gt;'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>I was asdf, now I'm qwer</div>
</div>
</div>
<div id="86b28921" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DEBUG(): </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    output_data <span class="op">=</span> get_capturer()._captures[<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>][<span class="dv">0</span>][<span class="st">'data'</span>]</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    test_eq(output_data[<span class="st">'text/plain'</span>], <span class="st">'&lt;IPython.core.display.HTML object&gt;'</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    html <span class="op">=</span> output_data[<span class="st">'text/html'</span>]</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="ss">f'&lt;brd-mark id="</span><span class="sc">{</span>brdd<span class="sc">.</span>dh<span class="sc">.</span>display_id<span class="sc">}</span><span class="ss">"'</span> <span class="kw">in</span> html, <span class="va">True</span>)  <span class="co"># type: ignore</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(brdd.dhs), <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="bb73c151" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">10</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>10</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>I was 17, now I'm 177</div>
</div>
</div>
<div id="dd6b7f08" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span><span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ZeroDivisionError</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[90], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color:rgb(98,98,98)" class="ansi-yellow-bg">1</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">/</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">0</span>

<span class="ansi-red-fg">ZeroDivisionError</span>: division by zero</pre>
</div>
</div>
</div>
<div id="8c989b09" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>get_bridged() .stop()</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>get_csi().stop()</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>get_capturer().stop()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ca41818c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>brdd.dhs[<span class="dv">0</span>].update(HTML(<span class="st">"&lt;div&gt;I was 4, now I'm 44&lt;/div&gt;"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ee779e47" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>brdd.dhs[<span class="dv">2</span>].update(HTML(<span class="st">"&lt;div&gt;I was asdf, now I'm qwer&lt;/div&gt;"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="c53c8f1c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>brdd.dh.update(HTML(<span class="st">"&lt;div&gt;I was 17, now I'm 177&lt;/div&gt;"</span>))  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<div id="5020c85f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_captures():</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> get_capturer()._captures</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cc:</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>        cprint(c)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'---------'</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>show_captures()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'1+3\n'</span>, <span style="font-weight: bold">[{</span><span style="color: #008000; text-decoration-color: #008000">'data'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'text/plain'</span>: <span style="color: #008000; text-decoration-color: #008000">'4'</span><span style="font-weight: bold">}</span>, <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{}}]]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span>
    <span style="color: #008000; text-decoration-color: #008000">"info = __lastcellinfo__\ntest_eq(__nb__[__lastcellinfo__.cell_id].outputs[0].data, {'text/plain': '4'})\ntest_eq(len(brdd.dhs), </span>
<span style="color: #008000; text-decoration-color: #008000">1)\nshow(DetailsJSON(__lastcellinfo__, openall=True))\n"</span>,
    <span style="font-weight: bold">[]</span>
<span style="font-weight: bold">]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span>
    <span style="color: #008000; text-decoration-color: #008000">"HTML('&lt;div&gt;asdf&lt;/div&gt;')\n"</span><span style="color: #000000; text-decoration-color: #000000">,</span>
<span style="color: #000000; text-decoration-color: #000000">    </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">[</span>
<span style="color: #000000; text-decoration-color: #000000">        </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">{</span>
<span style="color: #000000; text-decoration-color: #000000">            </span><span style="color: #008000; text-decoration-color: #008000">'data'</span><span style="color: #000000; text-decoration-color: #000000">: </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">{</span>
<span style="color: #000000; text-decoration-color: #000000">                </span><span style="color: #008000; text-decoration-color: #008000">'text/plain'</span><span style="color: #000000; text-decoration-color: #000000">: </span><span style="color: #008000; text-decoration-color: #008000">'&lt;IPython.core.display.HTML object&gt;'</span><span style="color: #000000; text-decoration-color: #000000">,</span>
<span style="color: #000000; text-decoration-color: #000000">                </span><span style="color: #008000; text-decoration-color: #008000">'text/html'</span><span style="color: #000000; text-decoration-color: #000000">: </span><span style="color: #008000; text-decoration-color: #008000">'&lt;div&gt;asdf&lt;/div&gt;\n&lt;brd-mark id="b3c829493-53426d78-6c9050ad-6e20e069"&gt;&lt;/brd-mark&gt;'</span>
            <span style="font-weight: bold">}</span>,
            <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{}</span>
        <span style="font-weight: bold">}</span>
    <span style="font-weight: bold">]</span>
<span style="font-weight: bold">]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span>
    <span style="color: #008000; text-decoration-color: #008000">'if DEBUG(): \n    output_data = get_capturer()._captures[-1][1][0][\'data\']\n    test_eq(output_data[\'text/plain\'], </span>
<span style="color: #008000; text-decoration-color: #008000">\'&lt;IPython.core.display.HTML object&gt;\')\n    html = output_data[\'text/html\']\n    test_eq(f\'&lt;brd-mark id="{brdd.dh.display_id}"\' in </span>
<span style="color: #008000; text-decoration-color: #008000">html, True)  # type: ignore\ntest_eq(len(brdd.dhs), 3)\n'</span>,
    <span style="font-weight: bold">[]</span>
<span style="font-weight: bold">]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'print(10)\n17\n'</span>, <span style="font-weight: bold">[{</span><span style="color: #008000; text-decoration-color: #008000">'data'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'text/plain'</span>: <span style="color: #008000; text-decoration-color: #008000">'17'</span><span style="font-weight: bold">}</span>, <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{}}]]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'1/0\n'</span>, <span style="font-weight: bold">[]]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'get_bridged() .stop()\nget_csi().stop()\nget_capturer().stop()\n'</span>, <span style="font-weight: bold">[]]</span>
</pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------</code></pre>
</div>
</div>
<div id="ff463ce1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_lines():</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> get_capturer()._lines</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cc:</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>        cprint(shorten(c, <span class="st">'r'</span>, <span class="dv">140</span>))</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'---------'</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>show_lines()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cb4b0c67" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DEBUG(): show_msgs(brdd)  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'msg_type'</span>: <span style="color: #008000; text-decoration-color: #008000">'display_data'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'content'</span>: <span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'data'</span>: <span style="font-weight: bold">{}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'bridge'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'captured'</span>: <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span><span style="font-weight: bold">}}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'transient'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'display_id'</span>: <span style="color: #008000; text-decoration-color: #008000">'b34bd6418-582983a0-eaaadd4f-12e98d9e'</span><span style="font-weight: bold">}</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'msg_type'</span>: <span style="color: #008000; text-decoration-color: #008000">'display_data'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'content'</span>: <span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'data'</span>: <span style="font-weight: bold">{</span>
            <span style="color: #008000; text-decoration-color: #008000">'text/html'</span>: <span style="color: #008000; text-decoration-color: #008000">'&lt;style&gt;details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } </span>
<span style="color: #008000; text-decoration-color: #008000">details…'</span>
        <span style="font-weight: bold">}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'transient'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'display_id'</span>: <span style="color: #008000; text-decoration-color: #008000">'bc4743314-1703b8af-012c6759-46fba1e2'</span><span style="font-weight: bold">}</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'msg_type'</span>: <span style="color: #008000; text-decoration-color: #008000">'display_data'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'content'</span>: <span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'data'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'text/html'</span>: <span style="color: #008000; text-decoration-color: #008000">'&lt;div&gt;asdf&lt;/div&gt;\n&lt;brd-mark id="b3c829493-53426d78-6c9050ad-6e20e069"&gt;&lt;/brd-mark&gt;'</span><span style="font-weight: bold">}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'bridge'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'captured'</span>: <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span><span style="font-weight: bold">}}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'transient'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'display_id'</span>: <span style="color: #008000; text-decoration-color: #008000">'b3c829493-53426d78-6c9050ad-6e20e069'</span><span style="font-weight: bold">}</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'msg_type'</span>: <span style="color: #008000; text-decoration-color: #008000">'display_data'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'content'</span>: <span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'data'</span>: <span style="font-weight: bold">{}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'metadata'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'bridge'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'captured'</span>: <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span><span style="font-weight: bold">}}</span>,
        <span style="color: #008000; text-decoration-color: #008000">'transient'</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'display_id'</span>: <span style="color: #008000; text-decoration-color: #008000">'b4e7c9b47-1eeb4595-2b85a414-25b2e188'</span><span style="font-weight: bold">}</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
</div>
</section>
<section id="capturetransformer" class="level1">
<h1>CaptureTransformer</h1>
<blockquote class="blockquote">
<p>Output capture with AST hooks.</p>
</blockquote>
<p><code>OutputCapture</code> works correctly, but conflicts with the debugger abounds as it alters the source code. Fortunately, IPython has another much more powerful hook mechanism, <code>ast_transformers</code>, that is cleaner and more flexible.</p>
<div id="2764923d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _ast_process_result(result):</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (shell <span class="op">:=</span> get_ipython()): <span class="cf">return</span> result</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>        info <span class="op">=</span> shell.user_ns[<span class="st">'__cellinfo__'</span>]</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result <span class="kw">is</span> <span class="kw">not</span> info: info.exec_result.result <span class="op">=</span> result</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>        display(result, metadata<span class="op">=</span>{<span class="st">'bridge'</span>: {<span class="st">'captured'</span>: <span class="va">True</span>}})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L279" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_capturer" class="level3">
<h3 class="anchored" data-anchor-id="get_capturer">get_capturer</h3>
<blockquote class="blockquote">
<pre><code> get_capturer (start=False)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/nb_hooks.py#L231" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="capturetransformer-1" class="level3">
<h3 class="anchored" data-anchor-id="capturetransformer-1">CaptureTransformer</h3>
<blockquote class="blockquote">
<pre><code> CaptureTransformer (mode='direct')</code></pre>
</blockquote>
<p>*A :class:<code>NodeVisitor</code> subclass that walks the abstract syntax tree and allows modification of nodes.</p>
<p>The <code>NodeTransformer</code> will walk the AST and use the return value of the visitor methods to replace or remove the old node. If the return value of the visitor method is <code>None</code>, the node will be removed from its location, otherwise it is replaced with the return value. The return value may be the original node in which case no replacement takes place.</p>
<p>Here is an example transformer that rewrites all occurrences of name lookups (<code>foo</code>) to <code>data['foo']</code>::</p>
<p>class RewriteName(NodeTransformer):</p>
<pre><code>   def visit_Name(self, node):
       return Subscript(
           value=Name(id='data', ctx=Load()),
           slice=Constant(value=node.id),
           ctx=node.ctx
       )</code></pre>
<p>Keep in mind that if the node you’re operating on has child nodes you must either transform the child nodes yourself or call the :meth:<code>generic_visit</code> method for the node first.</p>
<p>For nodes that were part of a collection of statements (that applies to all statement nodes), the visitor may also return a list of nodes rather than just a single node.</p>
<p>Usually you use the transformer like this::</p>
<p>node = YourTransformer().visit(node)*</p>
<div id="8f29cce7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>get_csi().stop()</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>get_bridged().stop()</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>get_capturer().stop()</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_id <span class="op">=</span> <span class="va">True</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>__nb__ <span class="op">=</span> NB()  <span class="co"># type: ignore</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>brdd <span class="op">=</span> get_bridged()</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>cptr <span class="op">=</span> get_capturer(<span class="va">True</span>)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>test_eq(get_ipython().ast_transformers, [cptr])  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="eafb6437" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>node <span class="op">=</span> cptr.visit_Module(ast.parse(<span class="st">'''</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="st">x = 10</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="st">y = 20</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="st">x + y</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span>))</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>test_eq(ast.unparse(node), <span class="st">'x = 10</span><span class="ch">\n</span><span class="st">y = 20</span><span class="ch">\n</span><span class="st">_ast_process_result(x + y)'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="953a1006" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">+</span> y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>30</code></pre>
</div>
</div>
<div id="44abca89" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>test_is(_ <span class="op">!=</span> <span class="dv">30</span>, <span class="va">True</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co"># test_eq(__lastcellinfo__.exec_result.result, 30)</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(__lastcellinfo__, summary<span class="op">=</span><span class="st">'__lastcellinfo__'</span>, openall<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>__nb__[__lastcellinfo__.cell_id]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>__lastcellinfo__
</summary>  <ul>
    <li>
<span><span class="n">source</span>: <span class="v string">x = 10
y = 20
x + y</span></span>    </li>
    <li>
<span><span class="n">cell_id</span>: <span class="v string">Y251sZmlsZQ==</span></span>    </li>
<details open=""><summary>exec_result
</summary>      <ul>
        <li>
<span><span class="n">result</span>: <span class="v number">30</span></span>        </li>
        <li>
<span><span class="n">execution_count</span>: <span class="v number">102</span></span>        </li>
        <li>
<span><span class="n">error_before_exec</span>: <span class="v null">None</span></span>        </li>
        <li>
<span><span class="n">error_in_exec</span>: <span class="v null">None</span></span>        </li>
      </ul>
</details>  </ul>
</details>
<brd-mark id="be0a70540-1f149071-1e9bf543-8b240db0"></brd-mark>
</div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@1
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">1</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">x = 10
y = 20
x + y</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y251sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">30</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'bridge': {'captured': True}, 'brd_did': 'be2adf707-956b7807-c1810422-23297835'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">102</span></span>    </li>
  </ul>
</details>
<brd-mark id="bff8f6d1b-8533a060-f4db7041-b94af3dc"></brd-mark>
</div>
</div>
<p>Note that <code>CaptureTranformer</code> changes the semantics of IPython code execution because is effectively disabling the <a href="https://ipython.readthedocs.io/en/latest/interactive/reference.html#output-caching-system">Output caching system</a> as it’s intercepting all cell outputs. <del>If you have any use for <code>_</code>|<code>_&lt;n&gt;</code>|<code>_oh</code>|<code>Out</code> variables, <code>CaptureTranformer</code> has the same effect as setting <code>InteractiveShell.cache_size</code> to 0.</del></p>
<p>During cell execution, IPython replaces <code>sys.displayhook</code> with a custom <code>DisplayHook</code> instance responsible for displaying the result of the cell execution (among many other things). <a href="https://civvic.github.io/bridget/bridget.html#bridget"><code>Bridget</code></a> now handles cell outputs (and does what <code>displayhook</code> did before to show the cell result). The shell <code>displayhook</code> then always receives a result of None. <a href="https://civvic.github.io/bridget/bridget.html#bridget"><code>Bridget</code></a> must replicate some (not sure what to do about the <code>shell.history_manager</code>) of the functionality of <code>displayhook</code> to ensure that output cache variables are updated correctly (see <a href="https://github.com/ipython/ipython/blob/4d0c438d617e49b77d68cd98208f7b2d371a1381/IPython/core/displayhook.py#L269">__call__</a>).</p>
<div id="c285a24a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestD:</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _ipython_display_(<span class="va">self</span>):</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># dhdl = DisplayId()</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># dhdl.display(self.text)</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>        IDISPLAY(HTML(<span class="st">'from _ipython_display_'</span>))</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>TestD()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
from _ipython_display_
<brd-mark id="b91d17647-da0db986-c9ab9be4-fb83af67"></brd-mark>
</div>
</div>
<div id="e8b9ad9f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>__nb__[__lastcellinfo__.cell_id]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@4
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">4</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">class TestD:
    def _ipython_display_(self):
        # dhdl = DisplayId()
        # dhdl.display(self.text)
        IDISPLAY(HTML('from _ip…</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y255sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">&lt;IPython.core.display.HTML object&gt;</span></span>                </li>
                <li>
<span><span class="n">text/html</span>: <span class="v string">from _ipython_display_
&lt;brd-mark id="b91d17647-da0db986-c9ab9be4-fb83af67"&gt;&lt;/brd-mark&gt;</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'brd_did': 'b91d17647-da0db986-c9ab9be4-fb83af67'}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">105</span></span>    </li>
  </ul>
</details>
<brd-mark id="bac0087a5-d8b4d4de-19583850-dbb69b4d"></brd-mark>
</div>
</div>
<div id="673a6521" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_show <span class="op">=</span> <span class="va">False</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="34185a2d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>Div(<span class="st">'Hey, Foo!'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb127"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span>Hey, Foo!<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div id="8ddb17b8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>__nb__[__lastcellinfo__.cell_id]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<style>details ul { list-style-type:none; list-style-position: outside; padding-inline-start: 22px; margin: 0; } details .string { color: #24837b; } details .string::before { content: "'"; } details .string::after { content: "'"; } details .number { color: #ad8301; } details .true { color: blue; } details .false { color: red; } details .null { color: gray; } span.n { color: darkgrey; } </style>
<details open=""><summary>NBCell@7
</summary>  <ul>
    <li>
<span><span class="n">idx</span>: <span class="v number">7</span></span>    </li>
    <li>
<span><span class="n">source</span>: <span class="v string">Div('Hey, Foo!')</span></span>    </li>
    <li>
<span><span class="n">id</span>: <span class="v string">Y261sZmlsZQ==</span></span>    </li>
    <li>
<span><span class="n">cell_type</span>: <span class="v string">code</span></span>    </li>
<details open=""><summary>outputs
</summary>      <ul>
<details open=""><summary>0
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">display_data</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">div(('Hey, Foo!',),{})</span></span>                </li>
                <li>
<span><span class="n">text/markdown</span>: <span class="v string">```html
&lt;div&gt;Hey, Foo!&lt;/div&gt;

```</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{'bridge': {'captured': True}, 'brd_did': 'bb5b04995-eaac4b3d-83f7e6db-c103ca68'}</span></span>            </li>
          </ul>
</details><details open=""><summary>1
</summary>          <ul>
            <li>
<span><span class="n">output_type</span>: <span class="v string">execute_result</span></span>            </li>
            <li>
<span><span class="n">execution_count</span>: <span class="v number">108</span></span>            </li>
<details open=""><summary>data
</summary>              <ul>
                <li>
<span><span class="n">text/plain</span>: <span class="v string">div(('Hey, Foo!',),{})</span></span>                </li>
                <li>
<span><span class="n">text/markdown</span>: <span class="v string">```html
&lt;div&gt;Hey, Foo!&lt;/div&gt;

```</span></span>                </li>
              </ul>
</details>            <li>
<span><span class="n">metadata</span>: <span class="v ">{}</span></span>            </li>
          </ul>
</details>      </ul>
</details>    <li>
<span><span class="n">execution_count</span>: <span class="v number">108</span></span>    </li>
  </ul>
</details>
<brd-mark id="bf2837584-ea0a8d6d-52eb8da4-0e13cf66"></brd-mark>
</div>
</div>
</section>
</section>
<section id="stop_hooks" class="level1">
<h1>stop_hooks</h1>
</section>
<section id="get_nb_from_hooks" class="level1">
<h1>get_nb_from_hooks</h1>
<div id="6b65aed1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>_BRDD_MIMES</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'application/javascript',
 'application/json',
 'application/pdf',
 'image/jpeg',
 'image/png',
 'image/svg+xml',
 'text/html',
 'text/latex',
 'text/markdown',
 'text/plain'}</code></pre>
</div>
</div>
<p>What does this module do?</p>
<ul>
<li>Receives IPython’s events to record cell info (what the kernel can possibly know before and after the cell run).</li>
<li>Hooks into the display system to convert all calls into <code>transient</code> calls with a display_id connected to the cell_id.</li>
<li>Transforms cell code with a custom AST transformer to redirect cell result to the display system.</li>
</ul>
<p>This way, Bridget effectively knows what each cell output is (except stdout/err for now) and how to reference and modify it using standard IPython features.</p>
<p>Is this enough to make Bridget a functional notebook editor? Not really, we need real-time updates of the notebook structure (the notebook state, what would be saved to disk as .ipynb) to be able to navigate the notebook.</p>
<p>That unfortunately requires to navigate the procellous waters of widgets and extensions. Good ol’ IPython and Jupyter are not designed to give the kernel knowledge about the notebook state in real time. We pythonistas deluded ourselves into thinking Jupiter is all about us, but a Jupyter notebook is really a JavaScript application that controls everything, including the model and the view. The kernel is a second class citizen that knows next to nothing about or even what is a notebook.</p>
<p>We’re going to fix that next.</p>
<hr>
<!-- # Colophon -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/civvic\.github\.io\/bridget");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/civvic/bridget/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>