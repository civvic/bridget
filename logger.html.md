# Loggers


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

<!-- # Prologue -->

# Canvas and Logger

> Unified logging across JavaScript and Python for Bridget monitoring

Bridget operates across multiple contexts: browser (JS), kernel
(Python), and extensions. This module provides a unified logging system
that works identically in all environments.

**Architecture:** - **Canvas**: Abstraction of a display area (where to
write) - **Logger**: Logging interface (what/how to write)

Bridget loggers write to Bridget canvases, allowing you to monitor all
Bridget activity in a single notebook cell - no need to check browser
console or configure Python logging separately.

**Used throughout Bridget** for debugging Bridge operations, state
updates, and plugin activity.

# Canvas

> Places to display content

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L43"
target="_blank" style="float:right; font-size:smaller">source</a>

### Canvas

>  Canvas ()

*Base class for output display areas in notebooks*

## DHCanvas

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L51"
target="_blank" style="float:right; font-size:smaller">source</a>

### DhCanvas

>  DhCanvas (height:int=200)

*Canvas using IPython DisplayHandle for dynamic updates*

``` python
cnv = DhCanvas(height=200)
```

``` python
cnv.show("What's up, world!<br>")
```

``` python
cnv.add("Take me to your leader.<br>")
```

``` python
cnv.clear()
```

``` python
cnv.add('<b>There and Back Again</b><br>')
```

``` python
cnv.show()
```

<div style='max-height:200px;border: 0.5px solid lightblue; overflow: auto;'><br>
<b>There and Back Again</b><br></div>

``` python
cnv.add('')
```

``` python
cnv.add('\n')
```

``` python
cnv.add('<br>')
```

## FCanvas (kernel)

> HTML element with a well-known id.

``` python
display(HTML(FCanvas_stl))
```

<style id="brd-logger-stl">
  @scope (.brd-logger) {
    :scope { 
      border: 1px solid steelblue; 
      overflow: auto; 
      font-family: monospace; 
      font-size: 13px; 
    }
    .ts { color:lightgray; }
  }
</style>

``` python
class FCanvas(Canvas, T.HasTraits):
    height = T.Int(200).tag(sync=True)
    elid = T.Unicode('').tag(sync=True)
    def show(self, content=None, **kwargs):
        prev_elid = self.elid
        elid = new_id('brd-logger-')
        s = content or ''
        display(HTML(
            f"<div id='{elid}' class='brd-logger' "
            f"style='width: 100%; max-height: {self.height}px;'>{(s+'<br>') if not prev_elid and s else ''}</div>"), 
            metadata=kwargs)
        time.sleep(0.25)
        self.elid = elid
        if prev_elid: 
            display(Javascript(f"""
debugger;
const prevEl = document.getElementById('{prev_elid}');
let prevHtml = prevEl?.innerHTML ?? '';
if (prevEl) prevEl.style.display = 'none';
if (prevEl) prevEl.innerHTML = '';
{self._el()}; if (el) {{ el.innerHTML = prevHtml + '{s.replace("'", "\\'")}' + '<br>';
el.scrollTop = el.scrollHeight;}}
"""))
    def hide(self): display(Javascript(f"{self._el()} el.style.display = 'none'"))
    def add(self, content, **kwargs):
        if content is not None: display(Javascript(self._js(str(content).replace("'", "\\'"))))
    def clear(self): display(Javascript(f"{self._el()} el.innerHTML = ''"))

    def _el(self): return f"const el=document.getElementById('{self.elid}')"
    def _js(self, s):
        return f"{self._el()}; if (el) {{el.innerHTML += '{s}'; el.scrollTop = el.scrollHeight;}}"
```

``` python
cnv = FCanvas(height=100)
```

``` python
cnv.show()
```

<div id='brd-logger-_1-1764771161' class='brd-logger' style='width: 100%; max-height: 100px;'></div>

``` python
for c in 'abcdefgehijk': cnv.add(f"{c}<br>")
```

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

    <IPython.core.display.Javascript object>

``` python
cnv.add(f'<span class="ts">1234567890</span> <span class="msg">msg</span><br>')
```

    <IPython.core.display.Javascript object>

``` python
cnv.add("lorem ipsum dolor sit 'amet<br>")
```

    <IPython.core.display.Javascript object>

``` python
cnv.show()
```

<div id='brd-logger-_2-1764771161' class='brd-logger' style='width: 100%; max-height: 100px;'></div>

    <IPython.core.display.Javascript object>

``` python
cnv.add({"a": 1})
```

    <IPython.core.display.Javascript object>

This is obviously ugly and unwieldy. We need a more usable canvas, one
that doen’t rely in IPython display system.. The only solution in modern
Jupyter envs is a widget.

## FCanvas (widget)

``` python
os.environ['DEBUG_BRIDGET'] = 'True'
```

``` python
fcanvas_esm = bundled(fcanvas_js)(debugger=DEBUG(), ts=True)
```

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L90"
target="_blank" style="float:right; font-size:smaller">source</a>

### FCanvas

>  FCanvas (height:int=200, elid:str='', **kwargs)

*Main AnyWidget base class.*

``` python
cleanupwidgets('cnv')

cnv = FCanvas.create(height=100, timeout=3)
test_eq(cnv.loaded(), True)
```

``` python
cnv.show('hello')
# test_eq(cnv.displayed(), True)
```

<div id='brd-logger_1-1764771161' class='brd-logger' style='width: 100%; max-height: 100px;'></div>

``` python
cnv.add(' bye<br>')
```

``` python
cnv.clear()
```

``` python
cnv.add('Goodbye to all that<br>')
```

``` python
cnv.add({'a': str(Path('a'))})  # convert to json, no '<br>'
```

``` python
cnv.add(f'<br><span class="ts">1234567890</span> <span class="msg">msg</span><br>')
```

``` python
cnv.hide()
cnv.add('hideous!<br>')
```

``` python
cnv.show()
```

<div id='brd-logger_2-1764771161' class='brd-logger' style='width: 100%; max-height: 100px;'></div>

``` python
cnv.close()
```

``` python
cleanupwidgets('cnv')

cnv = FCanvas.create(elid=FCanvas.new_elid())
test_eq(cnv.loaded(), True)
```

<div id='brd-logger_3-1764771161' class='brd-logger' style='width: 100%; max-height: 200px;'></div>

``` python
cnv.add('Hi & Bi<br>')
```

``` python
cnv.close()
```

# NBLogger

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L159"
target="_blank" style="float:right; font-size:smaller">source</a>

### NoopLogger

>  NoopLogger ()

*Logger that discards all messages*

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L140"
target="_blank" style="float:right; font-size:smaller">source</a>

### NBLogger

>  NBLogger ()

*Notebook loggers with show/hide/log capabilities*

## BasicLogger

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L164"
target="_blank" style="float:right; font-size:smaller">source</a>

### BasicLogger

>  BasicLogger (msg=None, canvas:__main__.Canvas|None=None, height:int=200,
>                   show:bool=True, history:bool=True, **kwargs)

*Simple logger that displays messages in a scrollable div*

``` python
bl = BasicLogger('BasicLogger initialized', height=100)
```

``` python
for i,x in enumerate(range(10)): bl.log(f'test{i}')
```

``` python
bl.msg(f'''<span style="color: red;">{'red '*100}</span>''')
```

``` python
bl.history()[-1]
```

    '<span style="color: red;">red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red red </span>'

Wrong HTML: the message is shortened with the HTML format

``` python
bl.log('green '*100, fmt='<span style="color: green;">{s}</span><br>')
```

``` python
bl.show()
```

``` python
bl.active(False, 'BasicLogger disabled')
```

    False

``` python
bl.error('test')
```

``` python
bl.show("Enabled")
```

<div style='max-height:100px;border: 0.5px solid lightblue; overflow: auto;'>Enabled<br>BasicLogger disabled<br><span style="color: green;">green green green green green green green green green green green green green green green green green green green green green green green gr…</span><br><span style="color: red;">red red red red red red red red red red red red red red red red red red red red red red red red red red red red re…<br>test9<br>test8<br>test7<br>test6<br>test5<br>test4<br>test3<br>test2<br>test1<br>test0<br>BasicLogger initialized<br></div>

``` python
bl.close_canvas()
bl.show()
bl.log('closed')
test_eq(bl.active(), False)
```

    This logger is closed.

## FLogger

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/logger.py#L218"
target="_blank" style="float:right; font-size:smaller">source</a>

### FLogger

>  FLogger (msg=None, canvas:__main__.Canvas|None=None, height:int=200,
>               show:bool=True, history:bool=True, **kwargs)

*Simple logger that displays messages in a scrollable div*

``` python
bl = FLogger('FLogger initialized', FCanvas.create(height=100, elid=FCanvas.new_elid(), timeout=2))
```

<div id='brd-logger_4-1764771161' class='brd-logger' style='width: 100%; max-height: 100px;'></div>

``` python
for i,x in enumerate(range(5)): bl.log(f'test{i}')
```

``` python
bl.error('red '*100, fmt=lambda s: f'<span style="color: red;">{s}</span>')
```

``` python
bl.show()
```

<div id='brd-logger_5-1764771161' class='brd-logger' style='width: 100%; max-height: 100px;'></div>

``` python
bl.active(False, 'FLogger disabled')
```

    False

``` python
bl.log('test')
```

``` python
bl.close_canvas()
bl.log('closed')
bl.show()
test_eq(bl.active(), False)
```

    This logger is closed.

## Loguru logger (WIP)

``` python
class LoguruBasicLogger(BasicLogger):
    def __init__(self): 
        super().__init__()
        self._fmt = FC.noop
    
    def write(self, message: str) -> None:
        if rec := getattr(message, 'record', None):
            level = rec['level'].name
        else: 
            for level in level_colors: 
                if level in message: break
        # message = f"<span style='color: {level_colors[level]}'>{message}</span>"
        # self.msg(message, fmt=lambda s:f"<span style='color: {level_colors[level]}'>{s}</span>")
        self.msg(message, fmt=f"<span style='color: {level_colors[level]}'>""{s}</span><br>")
```

``` python
logger.remove()  # Remove default handler
handler_id = logger.add(
    (lbl := LoguruBasicLogger()).write, 
    format="{level} | {message}",  # Simple format, we'll add HTML in the sink
    colorize=False  # Disable ANSI colors
)
```

<div style='max-height:200px;border: 0.5px solid lightblue; overflow: auto;'><span style='color: #ff0000'>ERROR | This is an error
</span><br><span style='color: #ff8800'>WARNING | This is a warning
</span><br><span style='color: #000000'>INFO | This is an info message
</span><br><span style='color: #666666'>DEBUG | This is a debug message
</span><br></div>

``` python
logger.debug("This is a debug message")
logger.info("This is an info message")
logger.warning("This is a warning")
logger.error("This is an error")
```

``` python
class LoguruBasicLogger(BasicLogger):
    def __init__(self):
        super().__init__()
        self.fmt = FC.noop
    
    def _format(self, msg, fmt: Callable[[str], str]|str|None=None, truncate:bool=True, sep:str='') -> str:
        rec = getattr(msg, 'record', json.loads(msg))
        return (
            f"<div style='display: flex; gap: 8px'>"
            f"<span style='color: #888'>{rec['time'].strftime('%H:%M:%S')}</span>"
            f"<span style='color: {level_colors[rec['level'].name]}'>{rec['level'].name:8}</span>"
            f"<span>{shorten(rec['message'], mode='r', limit=self.max_len or 140)}</span>"
            f"</div>"
        )

    def write(self, message:str) -> None:
        self.msg(message, sep='')
        # self.msg(formatted_msg)
    

def configure_logger(basic_logger: BasicLogger) -> int:
    """Configure loguru to use a specific BasicLogger instance."""
    logger.remove()
    return logger.add(
        basic_logger.write,  # type: ignore
        serialize=True  # This makes loguru pass a json to write()
    )
```

``` python
lbl = LoguruBasicLogger()
handler_id = configure_logger(lbl)
```

<div style='max-height:200px;border: 0.5px solid lightblue; overflow: auto;'><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:32</span><span style='color: #ff0000'>ERROR   </span><span>This is an error</span></div><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:32</span><span style='color: #ff8800'>WARNING </span><span>This is a warning</span></div><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:32</span><span style='color: #000000'>INFO    </span><span>This is an info message</span></div><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:32</span><span style='color: #666666'>DEBUG   </span><span>This is a debug message</span></div></div>

``` python
logger.debug("This is a debug message")
logger.info("This is an info message")
logger.warning("This is a warning")
logger.error("This is an error")
```

``` python
(my_logger := BasicLogger()).setup_loguru_sink(logger);  # type: ignore
```

<div style='max-height:200px;border: 0.5px solid lightblue; overflow: auto;'><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:33.608834</span><span style='width: 4em; color: #ff0000'>error   </span><span>This is an error</span></div><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:33.608047</span><span style='width: 4em; color: #ff8800'>warning </span><span>This is a warning</span></div><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:33.607341</span><span style='width: 4em; color: #000000'>info    </span><span>This is an info message</span></div><div style='display: flex; gap: 8px'><span style='color: #888'>15:13:33.606536</span><span style='width: 4em; color: #666666'>debug   </span><span>This is a debug message</span></div></div>

``` python
logger.debug("This is a debug message")
logger.info("This is an info message")
logger.warning("This is a warning")
logger.error("This is an error")
```

``` python
(my_flogger := FLogger()).setup_loguru_sink(logger);  # type: ignore
```

<div id='brd-logger_6-1764771161' class='brd-logger' style='width: 100%; max-height: 200px;'></div>

``` python
logger.debug("This is a debug message")
logger.info("This is an info message")
logger.warning("This is a warning")
logger.error("This is an error")
```

``` python
my_flogger.close_canvas()
```

------------------------------------------------------------------------

<!-- # Colophon -->
