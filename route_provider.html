<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Enables method-based routing in fasthtml by extending APIRouter capabilities.">

<title>Routes provider – bridget</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Routes provider – bridget">
<meta property="og:description" content="Enables method-based routing in fasthtml by extending APIRouter capabilities.">
<meta property="og:site_name" content="bridget">
<meta name="twitter:title" content="Routes provider – bridget">
<meta name="twitter:description" content="Enables method-based routing in fasthtml by extending APIRouter capabilities.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">bridget</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./helpers.html">Core Components</a></li><li class="breadcrumb-item"><a href="./route_provider.html">Routes provider</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridget</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Core Components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./helpers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jstransform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Javascript import transform</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fasthtml_patching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FastHTML patching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./route_provider.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Routes provider</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Bridge</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge_widget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridge widget helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logger.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loggers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridge helpers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge_plugins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridge plugins</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Notebook State</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook objects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_hooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook/IPython hooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_state.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook state</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Bridget</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bridget</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./details_json.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DetailsJSON</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">JavaScript &amp; Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./javascript_extensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JavaScript &amp; Extensions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples/quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">quickstart.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples/htmx_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HTMX Examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">(very) WIP</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./widget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Widget (very WIP)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_outline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TBD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./output_edit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Editable Outputs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anydoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AnyDoc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prompt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prompt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nb_mcp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TBD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nbdev_rt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">nbdev_rt</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#patched" id="toc-patched" class="nav-link active" data-scroll-target="#patched">patched</a></li>
  <li><a href="#methods-as-routes-endpoints" id="toc-methods-as-routes-endpoints" class="nav-link" data-scroll-target="#methods-as-routes-endpoints">Methods as routes endpoints</a>
  <ul class="collapse">
  <li><a href="#why-method-based-routes-in-notebooks" id="toc-why-method-based-routes-in-notebooks" class="nav-link" data-scroll-target="#why-method-based-routes-in-notebooks">Why Method-Based Routes in Notebooks?</a></li>
  </ul></li>
  <li><a href="#scoping" id="toc-scoping" class="nav-link" data-scroll-target="#scoping">Scoping</a>
  <ul class="collapse">
  <li><a href="#fasthtmls-route-requirements" id="toc-fasthtmls-route-requirements" class="nav-link" data-scroll-target="#fasthtmls-route-requirements">FastHTML’s Route Requirements</a></li>
  </ul></li>
  <li><a href="#routeprovider" id="toc-routeprovider" class="nav-link" data-scroll-target="#routeprovider">RouteProvider</a>
  <ul class="collapse">
  <li><a href="#routeprovider-1" id="toc-routeprovider-1" class="nav-link" data-scroll-target="#routeprovider-1">RouteProvider</a></li>
  <li><a href="#routeproviderp" id="toc-routeproviderp" class="nav-link" data-scroll-target="#routeproviderp">RouteProviderP</a></li>
  </ul></li>
  <li><a href="#apirouterd" id="toc-apirouterd" class="nav-link" data-scroll-target="#apirouterd">APIRouterD</a>
  <ul class="collapse">
  <li><a href="#apirouterc" id="toc-apirouterc" class="nav-link" data-scroll-target="#apirouterc">APIRouterC</a></li>
  <li><a href="#apirouterd-1" id="toc-apirouterd-1" class="nav-link" data-scroll-target="#apirouterd-1">APIRouterD</a>
  <ul class="collapse">
  <li><a href="#apirouterd-2" id="toc-apirouterd-2" class="nav-link" data-scroll-target="#apirouterd-2">APIRouterD</a></li>
  </ul></li>
  <li><a href="#route-names" id="toc-route-names" class="nav-link" data-scroll-target="#route-names">route names</a></li>
  </ul></li>
  <li><a href="#inheritance" id="toc-inheritance" class="nav-link" data-scroll-target="#inheritance">Inheritance</a></li>
  <li><a href="#apiroute" id="toc-apiroute" class="nav-link" data-scroll-target="#apiroute">APIRoute</a>
  <ul class="collapse">
  <li><a href="#apiroute-1" id="toc-apiroute-1" class="nav-link" data-scroll-target="#apiroute-1">APIRoute</a></li>
  </ul></li>
  <li><a href="#adding-routes-to-the-app" id="toc-adding-routes-to-the-app" class="nav-link" data-scroll-target="#adding-routes-to-the-app">Adding routes to the app</a>
  <ul class="collapse">
  <li><a href="#fasthtml-notebooks-scope-state" id="toc-fasthtml-notebooks-scope-state" class="nav-link" data-scroll-target="#fasthtml-notebooks-scope-state">FastHTML, Notebooks, Scope &amp; State</a></li>
  <li><a href="#add_routes" id="toc-add_routes" class="nav-link" data-scroll-target="#add_routes">add_routes</a>
  <ul class="collapse">
  <li><a href="#mount" id="toc-mount" class="nav-link" data-scroll-target="#mount">mount</a></li>
  <li><a href="#add_routes-1" id="toc-add_routes-1" class="nav-link" data-scroll-target="#add_routes-1">add_routes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#route-introspection" id="toc-route-introspection" class="nav-link" data-scroll-target="#route-introspection">Route introspection</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/civvic/bridget/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="route_provider.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./helpers.html">Core Components</a></li><li class="breadcrumb-item"><a href="./route_provider.html">Routes provider</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Routes provider</h1>
</div>

<div>
  <div class="description">
    Enables method-based routing in fasthtml by extending <code>APIRouter</code> capabilities.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<!-- # Prologue -->
<div id="cell-3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_app():</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (app <span class="op">:=</span> nb_app()), TestClient(app, base_url<span class="op">=</span><span class="st">'http://nb'</span>, headers<span class="op">=</span>{<span class="st">'hx-request'</span>: <span class="st">'1'</span>}), app.route</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="patched" class="level1">
<h1>patched</h1>
<blockquote class="blockquote">
<p>Quick hack to monkey-patch a module function.</p>
</blockquote>
<p><code>FastHTML</code> only considers as of now (v.0.12.0) names of static (possibly nested) functions. We’ll need to temporarily patch <a href="https://civvic.github.io/bridget/route_provider.html#nested_name"><code>nested_name</code></a> to get name of methods (see <a href="https://civvic.github.io/bridget/route_provider.html#apirouterd"><code>APIRouterD</code></a> below).</p>
</section>
<section id="methods-as-routes-endpoints" class="level1">
<h1>Methods as routes endpoints</h1>
<blockquote class="blockquote">
<p>Understanding FastHTML’s routing system and extending it to support instance methods.</p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this docs I use widget/component interchangeably.</p>
</div>
</div>
<section id="why-method-based-routes-in-notebooks" class="level3">
<h3 class="anchored" data-anchor-id="why-method-based-routes-in-notebooks">Why Method-Based Routes in Notebooks?</h3>
<p>FastHTML typically encourages defining components in separate modules. While this works great for web applications, notebooks have different workflows:</p>
<p><strong>Interactive Development</strong><br>
Notebooks are all about exploration and rapid prototyping. Everything happens in cells - they’re our unit of work. Notebooks are more akin to one page apps. When you’re quickly testing ideas or building one-time components, creating separate modules can feel like unnecessary overhead. Method-based routes let us define and test components right where we need them, with scoping and encapsulation.</p>
<p><strong>State Management</strong><br>
When building widgets, we often need to maintain state. Instance methods make this natural. While both modules and classes can handle state effectively, sometimes one approach fits better than the other. It’s nice to have options.</p>
<p><strong>Quick Iteration</strong><br>
The real advantage comes when you’re iterating on a component. You can write code, test it, and modify it all in the same context. Make a change, run the cell, see the results. No jumping between files or reloading modules needed.</p>
<p>This approach may complement FastHTML’s module-based components by providing another option for route management.</p>
</section>
</section>
<section id="scoping" class="level1">
<h1>Scoping</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>All this discussion is for current FastHTML, v0.12.0 at the time of this writing. FastHTML is young and nervous, so things may change quickly and unexpectedly.</p>
</div>
</div>
<div id="cell-8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> a(): <span class="cf">return</span> <span class="st">'a'</span>  <span class="co"># type: ignore</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">type</span>(a), FunctionType)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(a), <span class="ss">f"&lt;function a at 0x</span><span class="sc">{</span><span class="bu">id</span>(a)<span class="sc">:x}</span><span class="ss">&gt;"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>global_a <span class="op">=</span> a</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># @rt('/a', 'get')</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># def a(): return 'a'</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># or its nearly equivalent:</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> rt(<span class="st">'/a'</span>, <span class="st">'get'</span>)(a)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> a <span class="kw">is</span> <span class="kw">not</span> global_a</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(a), <span class="st">'/a'</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/a'</span>).text, <span class="st">'a'</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'a'</span>), <span class="st">'/a'</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>test_eq(a.to(), <span class="st">'/a'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">set</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].methods), {<span class="st">'GET'</span>, <span class="st">'HEAD'</span>})  <span class="co"># type: ignore</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/a'</span>, <span class="st">'post'</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> a(x:<span class="bu">int</span>): <span class="cf">return</span> <span class="ss">f'a </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/a?x=5'</span>).text, <span class="st">'a 5'</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">set</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].methods), {<span class="st">'POST'</span>})  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>FastHTML.route</code> decorator, or the common <code>rt</code> alias, creates a Starlette <code>Route</code> with an endpoint based on a static function, function <code>a</code> in this case. But it’s not function <code>a</code>, it’s a especial callable wrapped over the function <code>a</code> to facilitate route introspection.</p>
<p>During route definition, <code>a</code> is removed from the scope it was defined and can be used to create additional routes with other HTTP methods (with caveats, <code>'post'</code> is a especial case).</p>
<div id="cell-10" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> b():</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@rt</span>(<span class="st">'/b'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _b(): <span class="cf">return</span> <span class="st">'b'</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _b</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>innerb <span class="op">=</span> b()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/b'</span>).text, <span class="st">'b'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(innerb), <span class="st">'/b'</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'b__b'</span>), <span class="st">'/b'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>test_eq(innerb.to(), <span class="st">'/b'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Recent FastHTML versions also supports nested functions on local scopes.</p>
<div id="cell-12" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ar <span class="op">=</span> APIRouter()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">@ar</span>(<span class="st">'/c'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> c(): <span class="cf">return</span> <span class="st">'c'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(c), <span class="st">'/c'</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>test_eq(ar.c.to(), <span class="st">'/c'</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>test_eq(ar.rt_funcs.c.to(), <span class="st">'/c'</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>ar.to_app(app)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/c'</span>).text, <span class="st">'c'</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'c'</span>), <span class="st">'/c'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>APIRouter</code> is a convenient way of grouping routes.</p>
<section id="fasthtmls-route-requirements" class="level3">
<h3 class="anchored" data-anchor-id="fasthtmls-route-requirements">FastHTML’s Route Requirements</h3>
<p>FastHTML’s routing system builds on Starlette’s, which accepts both functions and methods as endpoints (besides ASGI classes). The only requirement is being a <a href="https://github.com/encode/starlette/blob/427a8dcf357597df27b2509b1ac436caf7708300/starlette/routing.py#L208">callable</a>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>endpoint: typing.Callable[..., typing.Any]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>FastHTML follows FastAPI’s style of using decorators for route definition. Route endpoints must be:<br>
1. Callables with a <code>__name__</code> (<code>__qualname__</code> as of v0.12.0) attribute (for route identification) <a href="https://github.com/AnswerDotAI/fasthtml/blob/bff83a9bca000c38c91909809e2726a51418793f/fasthtml/core.py#L608">FastHTML._add_route</a><br>
2. Have type annotations for all parameters (for request validation)</p>
<p>While this works for functions, it creates challenges with instance methods:</p>
<ol type="1">
<li><strong>Method Binding</strong>: When using decorators at class level, methods are still unbound functions:
<ul>
<li>The decorator sees the function <code>get</code>, not the bound method</li>
<li>The <code>self</code> parameter won’t be properly valued</li>
</ul></li>
<li><strong>Type Annotations</strong>: FastHTML expects all parameters to be annotated:
<ul>
<li>The implicit <code>self</code> parameter lacks annotation</li>
<li>This triggers warnings in FastHTML’s validation</li>
</ul></li>
</ol>
<p><code>APIRouter</code> like <code>rt</code> only works wth static functions.</p>
<p>As a workaround we could use <code>partial</code> (or FastHTML own trick, a lightweight stateful callable) to bind methods after instance creation. As partials don’t have a <code>__name__</code> (<code>__qualname__</code> now) attribute, we need to hack it manually:</p>
<div id="cell-15" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AClass:</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get(<span class="va">self</span>, a:<span class="bu">str</span>): <span class="cf">return</span> <span class="ss">f'</span><span class="sc">{</span><span class="va">self</span><span class="sc">!r}</span><span class="ss"> </span><span class="sc">{</span>a<span class="sc">!r}</span><span class="ss">'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> AClass()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually create bound method and set name</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>(f <span class="op">:=</span> partial(a.get.__func__, a)).<span class="va">__qualname__</span> <span class="op">=</span> <span class="st">'get'</span>  <span class="co"># type: ignore</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>rt(<span class="st">'/give/me/</span><span class="sc">{a}</span><span class="st">'</span>)(f)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>cli.get(<span class="st">'/give/me/b'</span>).text</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>"&lt;__main__.AClass object at 0x148080e60&gt; 'b'"</code></pre>
</div>
</div>
<p>This approach is verbose and error-prone, separates route definition from method implementation, and makes code harder to maintain, besides being cumbersome and ugly. We need something more in order to use methods as endpoints with fastHTML. It´s clearly time for some more python dark magic here. But we’re in python-land where magic abounds.</p>
<p>We’ll extend FastHTML’s routing capabilities by:<br>
- Creating an enhanced <code>APIRouter</code> class that support (and preserves) method references<br>
- Supporting automatic method binding at instance creation<br>
- Enabling property-based routing for GET/POST/PUT/DELETE operations<br>
- Providing automatic route mounting and path generation</p>
<p>We aim for a more natural and maintainable syntax:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Widget:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._value</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We’ll use the handy <code>APIRouter</code> to define routes providers.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most of this notebook was written before v0.12.0. In v0.9.1, <code>APIRouter</code> was defined but not used anywhere. I wasn’t sure Jeremy’s intention for the class, but it seemed appropiate using it here for our purposes.</p>
<p>From v0.10.2 to v0.12.0, <code>APIRouter</code> has evolved considerably but the basic idea proposed here holds through.</p>
</div>
</div>
<p>First, some helpers to get the routes from a provider and its class hierarchy.</p>
<div id="cell-18" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> routes_from(o: <span class="bu">object</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Yield all route descriptors (path,methods,name,include_in_schema,body_wrap) from class hierarchy in mro order"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> base <span class="kw">in</span> (o <span class="cf">if</span> <span class="bu">isinstance</span>(o, <span class="bu">type</span>) <span class="cf">else</span> <span class="bu">type</span>(o)).mro()[:<span class="op">-</span><span class="dv">1</span>]:  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(base, <span class="bu">type</span>) <span class="kw">or</span> <span class="kw">not</span> <span class="bu">hasattr</span>(base, <span class="st">'ar'</span>): <span class="cf">continue</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> <span class="cf">from</span> base.ar.routes</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_routes(app: FastHTML, o):</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f,p,m,n,<span class="op">*</span>_ <span class="kw">in</span> routes_from(o):</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        app.add_route(Route(p, f, methods<span class="op">=</span>m, name<span class="op">=</span>n))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>routes_from</code> returns the routes in MRO order. If we add the routes in that order, Starlette will match them in that order too (NOTE: check this is documented). As such, more specific endpoints have precedence over more generic ones.</p>
<p>Starlette accepts happily methods as endpoints, but as we’ve seen, not current FastHTML versions (0.12.0 as of this writing). In FastHTML, we need to use bound functions – AKA methods–. And that is a bit more involved than using <code>app.route</code> on static functions.</p>
<div id="cell-20" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouter()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/a'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> a(<span class="va">self</span>): <span class="cf">return</span> <span class="st">'a'</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B(A):</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouter()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/b'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> b(<span class="va">self</span>): <span class="cf">return</span> <span class="st">'b'</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> C(B):</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouter()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/c?v=</span><span class="sc">{v}</span><span class="st">'</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> c(<span class="va">self</span>, v:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="cf">return</span> <span class="ss">f'c </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> D(A):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouter()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/d'</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> d(<span class="va">self</span>): <span class="cf">return</span> <span class="st">'d'</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> E(B, D):</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouter()</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/a'</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>): <span class="cf">return</span> <span class="st">'e'</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>test_eq(C.mro()[:<span class="op">-</span><span class="dv">1</span>], [C, B, A])</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>test_eq(E.mro()[:<span class="op">-</span><span class="dv">1</span>], [E, B, D, A])</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>test_eq([_[<span class="dv">1</span>] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">list</span>(routes_from(C))],  [<span class="st">'/c?v=</span><span class="sc">{v}</span><span class="st">'</span>, <span class="st">'/b'</span>, <span class="st">'/a'</span>])</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>test_eq([_[<span class="dv">1</span>] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">list</span>(routes_from(E))],  [<span class="st">'/a'</span>, <span class="st">'/b'</span>, <span class="st">'/d'</span>, <span class="st">'/a'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-21" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>add_routes(app, C)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>test_eq([_.path <span class="cf">for</span> _ <span class="kw">in</span> app.routes], [<span class="st">'/c?v=</span><span class="sc">{v}</span><span class="st">'</span>, <span class="st">'/b'</span>, <span class="st">'/a'</span>])  <span class="co"># type: ignore</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>c_rt <span class="op">=</span> app.routes[<span class="dv">0</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>match, _ <span class="op">=</span> c_rt.matches({<span class="st">'type'</span>: <span class="st">'http'</span>, <span class="st">'path'</span>: <span class="st">'/c?v=3'</span>, <span class="st">'method'</span>: <span class="st">'GET'</span>})</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>test_eq(match, Match.FULL)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>match, _ <span class="op">=</span> c_rt.matches({<span class="st">'type'</span>: <span class="st">'http'</span>, <span class="st">'path'</span>: <span class="st">'/c?v=7'</span>, <span class="st">'method'</span>: <span class="st">'PUT'</span>})</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>test_eq(match, Match.PARTIAL)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-22" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>add_routes(app, E)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>test_eq([_.path <span class="cf">for</span> _ <span class="kw">in</span> app.routes], [<span class="st">'/a'</span>, <span class="st">'/b'</span>, <span class="st">'/d'</span>, <span class="st">'/a'</span>])  <span class="co"># type: ignore</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>e_rt <span class="op">=</span> app.routes[<span class="dv">0</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>match, child_scope <span class="op">=</span> e_rt.matches({<span class="st">'type'</span>: <span class="st">'http'</span>, <span class="st">'path'</span>: <span class="st">'/a'</span>, <span class="st">'method'</span>: <span class="st">'GET'</span>})</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>test_eq(match, Match.FULL)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>test_eq(child_scope[<span class="st">'endpoint'</span>], e_rt.endpoint)  <span class="co"># type: ignore</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>test_eq(e_rt.endpoint(<span class="st">''</span>), <span class="st">'e'</span>)  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="routeprovider" class="level1">
<h1>RouteProvider</h1>
<blockquote class="blockquote">
<p>Any object with an <code>APIRouter</code> attribute can be a provider of routes.</p>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/routing.py#L55" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="routeprovider-1" class="level3">
<h3 class="anchored" data-anchor-id="routeprovider-1">RouteProvider</h3>
<blockquote class="blockquote">
<pre><code> RouteProvider ()</code></pre>
</blockquote>
<p><em>Base class for objects that provide routes via an APIRouter</em></p>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/routing.py#L50" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="routeproviderp" class="level3">
<h3 class="anchored" data-anchor-id="routeproviderp">RouteProviderP</h3>
<blockquote class="blockquote">
<pre><code> RouteProviderP (*args, **kwargs)</code></pre>
</blockquote>
<p><em>A provider of routes</em></p>
</section>
</section>
<section id="apirouterd" class="level1">
<h1>APIRouterD</h1>
<blockquote class="blockquote">
<p>APIRouter as a descriptor</p>
</blockquote>
<p>APIRouter for Method-Based Routes.</p>
<p>Extends <code>FastHTML</code>’s <code>APIRouter</code> to preserve method references while enabling route registration.</p>
<p><del>For reasons unclear to me, APIRouter wipes out the functions when defining routes unlike normal <code>@rt</code> decorator.</del></p>
<p>We need to keep the functions around in order for the class to get its methods.</p>
<p><a href="https://civvic.github.io/bridget/route_provider.html#apirouterd"><code>APIRouterD</code></a> preserves the original method references while collecting routes. This allows methods to work both as routes and methods, with proper instance binding. Like FastHTML’s standard APIRouter, routes are stored but not registered immediately, which lets us bind them to instances at mount time. This delayed registration enables stateful components and works naturally with Python properties and methods, maintaining compatibility with all FastHTML’s routing features.</p>
<div id="cell-27" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>test_eq(_replace(<span class="st">''</span>), <span class="st">''</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>test_eq(_replace(<span class="st">'a.b'</span>), <span class="st">'a_b'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>test_eq(_replace(<span class="st">'/'</span>, sep<span class="op">=</span><span class="st">'/'</span>), <span class="st">''</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>test_eq(_replace(<span class="st">'/a'</span>, sep<span class="op">=</span><span class="st">'/'</span>), <span class="st">'a'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>test_eq(_replace(<span class="st">'/a/'</span>, sep<span class="op">=</span><span class="st">'/'</span>), <span class="st">'a'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>test_eq(_replace(<span class="st">'/a/b'</span>, sep<span class="op">=</span><span class="st">'/'</span>), <span class="st">'a_b'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-28" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> nested_name(f):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Get name of function/method `f` using rep to join nested function names"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _replace(f.<span class="va">__qualname__</span>.replace(<span class="st">'.&lt;locals&gt;.'</span>, <span class="st">'_'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-29" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ff(): <span class="cf">return</span> <span class="st">'ff'</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ff</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>test_eq(nested_name(f), <span class="st">'f'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>test_eq(nested_name(f()), <span class="st">'f_ff'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(<span class="va">self</span>):</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> ff(): <span class="cf">return</span> <span class="st">'ff'</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ff</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>test_eq(nested_name(A.f), <span class="st">'A_f'</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>test_eq(nested_name(A.f(A())), <span class="st">'A_f_ff'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-30" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(<span class="va">self</span>):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> ff(): <span class="cf">return</span> <span class="st">'ff'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ff</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> _patched(fasthtml.core, <span class="st">'nested_name'</span>, nested_name):</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    test_eq(fasthtml.core.nested_name(A.f), <span class="st">'A_f'</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    test_eq(fasthtml.core.nested_name(A.f(A())), <span class="st">'A_f_ff'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We monkey-patch temporarily the <code>core</code> module to change its <a href="https://civvic.github.io/bridget/route_provider.html#nested_name"><code>nested_name</code></a> function with ours.</p>
<p>I think the original intuition of Jeremy with APIRouter was correct: a simple class that gather the routes arguments and defined the final routes in to_app. But as it removed the functions from the definition scope, it was not possible to inspect the routes with usual to() or reverse lookup URLs.</p>
<p>Current version solves the issue and also adds to APIRouter a <code>rt_funcs</code> property with the (non HTTP methods) routes.</p>
<section id="apirouterc" class="level2">
<h2 class="anchored" data-anchor-id="apirouterc">APIRouterC</h2>
<p><a href="https://www.fastht.ml/docs/api/core.html#nested_name"><code>fasthtml.core.nested_name</code></a> only considers static (possibly nested) functions.</p>
<p>Current APIRouter (v0.12.0) has a minor issue in _wrap_func, it uses <code>__name__</code> for the name of the route instead of <code>__qualname__</code>. I could patch it, but this subclass will do for now.</p>
<p>APIRouterC also has an alternative to rt_funcs, given the method name: - APIRouterC.to(name, …) return the full route path. - APIRouterC.name(name) return the full route name (if name was provided when adding the APIRouter). - <del>can use HTTP methods as method names (though why?)</del></p>
</section>
<section id="apirouterd-1" class="level2">
<h2 class="anchored" data-anchor-id="apirouterd-1">APIRouterD</h2>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/routing.py#L165" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="apirouterd-2" class="level3">
<h3 class="anchored" data-anchor-id="apirouterd-2">APIRouterD</h3>
<blockquote class="blockquote">
<pre><code> APIRouterD (*args, **kwargs)</code></pre>
</blockquote>
<p><em>Add routes to an app</em></p>
<div id="cell-37" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value:<span class="bu">int</span><span class="op">=</span><span class="dv">3</span>): <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>  <span class="co"># path /, name A_index</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> index(<span class="va">self</span>):</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># int 0 is not a valid FastHTML return value</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.value <span class="cf">if</span> <span class="va">self</span>.value <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> HTMLResponse(<span class="st">'0'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>  <span class="co"># or @ar.get or @ar.get('/a')</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> a(<span class="va">self</span>): <span class="cf">return</span> <span class="ss">f'a </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar.post</span>(<span class="st">'/a'</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> a_change(<span class="va">self</span>, x:<span class="bu">int</span>): <span class="va">self</span>.value <span class="op">=</span> x<span class="op">;</span> <span class="cf">return</span> <span class="ss">f'new value </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/b'</span>)  <span class="co"># name A_b, , method [GET, POST]</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> b(<span class="va">self</span>): <span class="cf">return</span> <span class="ss">f'b </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>  </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> c(): <span class="cf">return</span> <span class="st">'c'</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> d(cls): <span class="cf">return</span> <span class="ss">f'd </span><span class="sc">{</span>cls<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">'</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span>  <span class="co"># path /e, name A_e, method GET</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>): <span class="cf">return</span> <span class="ss">f'e </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value<span class="sc">}</span><span class="ss">'</span>  <span class="co"># type: ignore</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">@e.setter</span>  <span class="co"># path /e, name A_e, method [POST, PUT]</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>, x:<span class="bu">int</span>): <span class="va">self</span>.value <span class="op">=</span> x<span class="op">;</span> <span class="cf">return</span> x  <span class="co"># type: ignore</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>  <span class="co"># path /e, name A_e, method DELETE</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">@e.deleter</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>): <span class="kw">del</span> <span class="va">self</span>.value<span class="op">;</span> <span class="cf">return</span> Response(status_code<span class="op">=</span><span class="dv">204</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/f'</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get(<span class="va">self</span>): <span class="cf">return</span> <span class="st">'get'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-38" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> A()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>test_eq(a.b(), <span class="st">'b 3'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>test_is(<span class="st">'bound'</span> <span class="kw">in</span> <span class="bu">str</span>(a.a), <span class="va">True</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>test_eq(A.ar.to(<span class="st">'d'</span>), <span class="st">'/d'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>test_eq(A.ar.to(<span class="st">'a'</span>, x<span class="op">=</span><span class="dv">4</span>), <span class="st">'/a?x=4'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-39" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> A()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>a.ar.to_app(app)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-40" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>app.routes</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>[Route(path='/', name='index', methods=['GET', 'HEAD']),
 Route(path='/a', name='a', methods=['GET', 'HEAD']),
 Route(path='/a', name='a_change', methods=['POST']),
 Route(path='/b', name='b', methods=['GET', 'HEAD']),
 Route(path='/c', name='c', methods=['GET', 'HEAD']),
 Route(path='/d', name='d', methods=['GET', 'HEAD']),
 Route(path='/e', name='e', methods=['GET', 'HEAD']),
 Route(path='/e', name='e', methods=['POST', 'PUT']),
 Route(path='/e', name='e', methods=['DELETE']),
 Route(path='/f', name='get', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p><code>a</code> is a normal instance of <code>A</code>.</p>
<p><code>A.ar</code> is an instance of <a href="https://civvic.github.io/bridget/route_provider.html#apirouterd"><code>APIRouterD</code></a>, a subclass of <a href="https://civvic.github.io/bridget/route_provider.html#apirouterc"><code>APIRouterC</code></a>. It has basic route instrospection (<code>.to</code>, <code>.name</code>), but its really a descriptor. Its main function is storing the routes precursors like APIRouter does. Once the instance <code>a</code> is created, it assigns <code>a.ar</code> with a normal APIRouterC. When <code>ar.to_app(app)</code> is called, the final route endpoints are binded to the instance and installed.</p>
<p>Note that the APIRouter workflow setups the endpoints before calling <code>to_app(app)</code>, endpoints are static functions. APIRouterC delays that setup until the very last moment, when <code>to_app(app)</code> is called. This lazy binding allows adding different routes in distinct scopes (see <code>Adding routes to the app</code>, <a href="https://civvic.github.io/bridget/route_provider.html#add_routes"><code>add_routes()</code></a> and <a href="https://civvic.github.io/bridget/route_provider.html#mount"><code>mount()</code></a>).</p>
<div id="cell-42" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/'</span>).text, <span class="st">'3'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/a'</span>).text, <span class="st">'a 3'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/a?x=5'</span>).text, <span class="st">'new value 5'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>test_eq(a.value, <span class="dv">5</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/b'</span>).text, <span class="st">'b 5'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/c'</span>).text, <span class="st">'c'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/d'</span>).text, <span class="st">'d A'</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/e'</span>).text, <span class="st">'e 5'</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/e?x=7'</span>).text, <span class="st">'7'</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>test_eq(a.value, <span class="dv">7</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(cli.delete(<span class="st">'/e'</span>)), <span class="st">'&lt;Response [204 No Content]&gt;'</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>a.value <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/'</span>).text, <span class="st">'0'</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/f'</span>).text, <span class="st">'get'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-43" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'a'</span>), <span class="st">'/a'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(a.ar.name(<span class="st">'a'</span>)), <span class="st">'/a'</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(a.ar.a), <span class="st">'/a'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>test_eq(a.ar.a.to(), <span class="st">'/a'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>test_eq(a.ar.to(<span class="st">'a'</span>), <span class="st">'/a'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">set</span>([<span class="op">*</span><span class="bu">filter</span>(<span class="kw">lambda</span> r: r.path <span class="op">==</span> <span class="st">'/a'</span>, app.routes)][<span class="dv">0</span>].methods), {<span class="st">'GET'</span>, <span class="st">'HEAD'</span>})  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that <code>ar</code> can also setup properties as routes. Use as above, or simply once on the last descriptor function.</p>
<div id="cell-45" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value:<span class="bu">int</span><span class="op">=</span><span class="dv">3</span>): <span class="va">self</span>.value <span class="op">=</span> value</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>): <span class="cf">return</span> <span class="ss">f'e </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>value<span class="sc">}</span><span class="ss">'</span>  <span class="co"># type: ignore</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@e.setter</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>, x:<span class="bu">int</span>): <span class="va">self</span>.value <span class="op">=</span> x<span class="op">;</span> <span class="cf">return</span> x  <span class="co"># type: ignore</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@e.deleter</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> e(<span class="va">self</span>): <span class="kw">del</span> <span class="va">self</span>.value<span class="op">;</span> <span class="cf">return</span> Response(status_code<span class="op">=</span><span class="dv">204</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> A()</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>a.ar.to_app(app)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/e?x=3'</span>).text, <span class="st">'3'</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>test_eq(a.value, <span class="dv">3</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(cli.delete(<span class="st">'/e'</span>)), <span class="st">'&lt;Response [204 No Content]&gt;'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-46" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>test_eq(A.ar.to(), <span class="st">''</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>test_eq(A.ar.to(<span class="st">'e'</span>), <span class="st">'/e'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">AttributeError</span>): A.ar.a</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">AttributeError</span>): A.ar.rt_funcs.a</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">TypeError</span>): A.ar.to_app(app)  <span class="co"># APIRouterD is not a valid APIRouter</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that the <a href="https://civvic.github.io/bridget/route_provider.html#apirouterd"><code>APIRouterD</code></a> of the class, <code>A.ar</code> in the example above, is not an APIRouter, should be used only for basic route inspection. The one on the instance, <code>a.ar</code>, is the one which actually can register the routes and is, in fact, a normal <code>APIRouter</code>.</p>
<p>An <code>APIRouterD route</code>is very alike <code>FastHTML.route</code> or <code>APIRouter</code>’s. But as its underlying endpoint is a method/property, it has some different behaviors:</p>
</section>
</section>
<section id="route-names" class="level2">
<h2 class="anchored" data-anchor-id="route-names">route names</h2>
<div id="cell-50" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="at">@rt</span>(<span class="st">'/a'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> a(): <span class="cf">return</span> <span class="st">'a'</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'route from a -&gt;'</span><span class="sc">:&gt;20}</span><span class="ss">"</span>, app.routes[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(a), <span class="st">'/a'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>test_eq(a.to(), app.url_path_for(<span class="st">'a'</span>))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>test_eq(a.__routename__, <span class="st">'a'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> b():</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@rt</span>(<span class="st">'/a'</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> c(): <span class="cf">return</span> <span class="st">'c'</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> b()</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'route from c -&gt;'</span><span class="sc">:&gt;20}</span><span class="ss">"</span>, app.routes[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(c), <span class="st">'/a'</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>test_eq(c.to(), app.url_path_for(<span class="st">'b_c'</span>))</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>test_eq(c.__routename__, <span class="st">'b_c'</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> D:</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD(<span class="st">'/D'</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/a'</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> d(<span class="va">self</span>): <span class="cf">return</span> <span class="st">'d'</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> D()</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>d.ar.to_app(app)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'route from d.d -&gt;'</span><span class="sc">:&gt;20}</span><span class="ss">"</span>, app.routes[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(d.ar.d), <span class="st">'/D/a'</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>test_eq(d.ar.d.to(), app.url_path_for(<span class="st">'d'</span>))</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>test_eq(d.ar.d.__routename__, <span class="st">'d'</span>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>test_eq(d.ar.to(<span class="st">'d'</span>), d.ar.rt_funcs.d.to())</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>test_eq(d.ar.name(<span class="st">'d'</span>), <span class="st">'d'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     route from a -&gt; Route(path='/a', name='a', methods=['GET', 'HEAD', 'POST'])
     route from c -&gt; Route(path='/a', name='b_c', methods=['GET', 'HEAD', 'POST'])
[Route(path='/a', name='a', methods=['GET', 'HEAD', 'POST']), Route(path='/a', name='b_c', methods=['GET', 'HEAD', 'POST']), Route(path='/D/a', name='d', methods=['GET', 'HEAD'])]
   route from d.d -&gt; Route(path='/D/a', name='d', methods=['GET', 'HEAD'])</code></pre>
</div>
</div>
<ul>
<li>route name is the method name, <code>D_a</code> in the example above, not <code>d</code>.</li>
<li>default method is ‘get’.</li>
<li><strong>Route Introspection</strong>: Methods don´t get the <code>.to</code> attribute, like the wrappers used in routes. But those wrappers are, discoverable through <code>.ar</code> (e.g.&nbsp;<code>d.ar.d.to()</code> or <code>d.ar.to('d')</code>).</li>
<li>unlike <code>@rt/APIRouter</code>, it doesn’t wipe out (see _add_route) the underlying function from the scope (class def) for obvious reasons– base methods would probably be ok, properties not. Python classes can’t have methods with the same name– dicts, you know.<br>
If you want to handle different HTTP methods, you must use different func names or set them explcitly with the route arguments and modify the function to handle the distinct requests (args or explicit request arg).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Last point is a design decission. We could use metaclasses like fastcore transforms to introduce methods overriden by HTTP methods and in theory _mk_locfunc wrappers could function with methods (probably, not tested much). But I think a descriptor is already enough python dark magic for today :)</p>
</div>
</div>
</section>
</section>
<section id="inheritance" class="level1">
<h1>Inheritance</h1>
<p>As usual with OOP and classes, let’s say its complicated.</p>
<div id="cell-53" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">str</span> <span class="op">=</span> <span class="st">'a'</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B(A):</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    _value: <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>(a <span class="op">:=</span> A()).ar.to_app(app)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>(b <span class="op">:=</span> B()).ar.to_app(app)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(a.ar.value), <span class="st">'/value'</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(b.ar.value), <span class="st">'/value'</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/value'</span>).text, <span class="st">'1'</span>)  <span class="co"># a not accesible, overriden by b</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Basic inheritance, B.value() supercedes A.value().</p>
<p>To be able to access both objects, we need to use different routes for each object using <code>prefix</code>.</p>
<div id="cell-55" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A:</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD(<span class="st">'/A'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">str</span> <span class="op">=</span> <span class="st">'a'</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B(A):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD(<span class="st">'/B'</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    _value: <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>(a <span class="op">:=</span> A()).ar.to_app(app)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>(b <span class="op">:=</span> B()).ar.to_app(app)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">str</span>(b.ar.value), <span class="st">'/B/value'</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/A/value'</span>).text, <span class="st">'a'</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/B/value'</span>).text, <span class="st">'1'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/A/value', name='value', methods=['GET', 'HEAD']), Route(path='/B/value', name='value', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>But we can easily complicate things by using e.g, abstracts or mixins. Consider this contrived example.</p>
<div id="cell-57" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A_mixin:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">int</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B(A_mixin):</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar.post</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>, x:<span class="bu">int</span>): <span class="va">self</span>._value <span class="op">=</span> x</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> C(B):</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD()</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>(b <span class="op">:=</span> B()).ar.to_app(app)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>(c <span class="op">:=</span> C()).ar.to_app(app)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>test_eq(b.ar.value.to(), <span class="st">'/value'</span>)  <span class="co"># but not accesible, overriden by c</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.value.to(), <span class="st">'/value'</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co"># python fails</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>test_eq(c._value, <span class="dv">1</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">TypeError</span>): b.value()  <span class="co"># type: ignore</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">TypeError</span>): c.value()  <span class="co"># type: ignore</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="co"># starlette has no problems</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/value'</span>).text, <span class="st">'1'</span>)  <span class="co"># &lt;-- equivalent to A.value(c)</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(c.ar.value.to(x<span class="op">=</span><span class="dv">5</span>)).text, <span class="st">''</span>)  <span class="co"># &lt;-- equivalent to B.value(c, x=5)</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>test_eq(c._value, <span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['POST']), Route(path='/value', name='value', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p><code>b</code> is effectevely invisible to FastHTML Starlette.</p>
<p>Easy then, <code>prefix</code> each APIRouter like before.</p>
<div id="cell-59" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A_mixin:</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD(<span class="st">'/A'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">int</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B(A_mixin):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD(<span class="st">'/AB'</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar.post</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>, x:<span class="bu">int</span>): <span class="va">self</span>._value <span class="op">=</span> x</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> C(B):</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    ar <span class="op">=</span> APIRouterD(<span class="st">'/ABC'</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>(b <span class="op">:=</span> B()).ar.to_app(app)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>(c <span class="op">:=</span> C()).ar.to_app(app)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>test_eq(b.ar.value.to(), <span class="st">'/AB/value'</span>)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.value.to(), <span class="st">'/ABC/value'</span>)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>test_eq(c._value, <span class="dv">1</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">TypeError</span>): b.value()  <span class="co"># type: ignore</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">TypeError</span>): c.value()  <span class="co"># type: ignore</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ExceptionExpected(<span class="pp">AttributeError</span>): cli.get(<span class="st">'/AB/value'</span>).text</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(b.ar.value.to(x<span class="op">=</span><span class="dv">3</span>)).text, <span class="st">''</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>test_eq(b._value, <span class="dv">3</span>)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/AB/value'</span>).text, <span class="st">'3'</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/ABC/value'</span>).text, <span class="st">'1'</span>)  <span class="co"># &lt;-- equivalent to A.value(c)</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(c.ar.value.to(x<span class="op">=</span><span class="dv">5</span>)).text, <span class="st">''</span>)  <span class="co"># &lt;-- equivalent to B.value(c, x=5)</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>test_eq(c._value, <span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/AB/value', name='value', methods=['POST']), Route(path='/AB/value', name='value', methods=['GET', 'HEAD']), Route(path='/ABC/value', name='value', methods=['POST']), Route(path='/ABC/value', name='value', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>In normal use, you probably won’t have to worry about this. Nevertheless you must be careful mixing inheritance and Starlette routing.</p>
<p>Method resolution in python follows <a href="https://docs.python.org/3/howto/mro.html#python-2-3-mro">MRO</a>. Starlette routes lay in a flattened space, a list (or list of lists if sub-mounting). Unlike python, routes are matched in the order they are added by path, path parmas <strong>and</strong> HTTP methods. Unlike Starlette, FastHTML checks path and HTTP methods when adding routes, but the basic look-up remains the same.</p>
<p>In the contrived example above, python call fails, but Starlette has no problem finding the appropriate route because HTTP methds are different. A Route endpoint is a function, unbounded or, if using APIRouterD, bounded to the instance (of type C, not B or A, in the example). FastHTML adds extended functionality such as typing and introspection. The call works, but not in a pythonic way.</p>
<p>Without getting into <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov</a> and subtyping and the rest of OOP can of worms, think of APIRouterD as a way of organize routes and encapsulate state, nothing more. In Hypermedia systems, inheritance, classes, typing are ill defined concepts if at all. There’s not such thing as a “subclass” of a resource. Resources are uniquely idewntified with URIs, oprganized in hypermedia networks obtained with hypermedia controls. Semantics or behaviors are a thing of the server. The client only knows URIs.</p>
<p>So, stick with simple, flat scopes, and if you must, be very careful defining routes when inheritance is involved.</p>
</section>
<section id="apiroute" class="level1">
<h1>APIRoute</h1>
<blockquote class="blockquote">
<p>Convenience shortcut to avoid defining explictly <a href="https://civvic.github.io/bridget/route_provider.html#apirouterd"><code>APIRouterD</code></a> class var <code>ar</code>.</p>
</blockquote>
<p>It´s annoying having to define explicitly an <code>ar</code> class var for each class. Coould we have a similar shortcut like <code>rt</code> in normal FastHTML?</p>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/routing.py#L242" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="apiroute-1" class="level3">
<h3 class="anchored" data-anchor-id="apiroute-1">APIRoute</h3>
<blockquote class="blockquote">
<pre><code> APIRoute (path=None, methods=None, name=None, include_in_schema=True,
           body_wrap=&lt;function noop_body&gt;)</code></pre>
</blockquote>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<div id="cell-63" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ar <span class="op">=</span> APIRoute</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-64" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestAR:</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, a): <span class="va">self</span>.a <span class="op">=</span> a</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@APIRoute</span>(<span class="st">'/hi'</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> hi(): <span class="cf">return</span> <span class="ss">f'hi there'</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/yoyo'</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> yoyo(<span class="va">self</span>): </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f'a yoyo called </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>a<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> foo(<span class="va">self</span>): </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f'foo </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>a<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> TestAR(<span class="st">'yo'</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>test_eq(t.yoyo(), <span class="st">'a yoyo called yo'</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>t.ar.to_app(app)  <span class="co"># type: ignore</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/hi'</span>).text, <span class="st">'hi there'</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/yoyo'</span>).text, <span class="st">'a yoyo called yo'</span>)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/foo'</span>).text, <span class="st">'foo yo'</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>test_eq(t.ar.yoyo.to(), <span class="st">'/yoyo'</span>)  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If you don’t need to initialize APIRouterD (e.g.&nbsp;<code>prefix</code>), or setup it afterwards, or mind defining the <a href="https://civvic.github.io/bridget/route_provider.html#apirouterd"><code>APIRouterD</code></a> attribute explicitly, use <a href="https://civvic.github.io/bridget/route_provider.html#apiroute"><code>APIRoute</code></a> or the <code>ar</code> shortcut. It works fine if you don´t mind type checking false negatives.</p>
<p>If like me, you like static type checking at dev time but not stupid wiggly reds <span style="color:red">~~~</span>, inherit from <a href="https://civvic.github.io/bridget/route_provider.html#routeprovider"><code>RouteProvider</code></a>.</p>
<div id="cell-66" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> A(RouteProvider):</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    _value:Any</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> B(A):</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar.post</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> value(<span class="va">self</span>, value:<span class="bu">int</span><span class="op">|</span><span class="va">None</span><span class="op">=</span><span class="va">None</span>):</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>: <span class="va">self</span>._value <span class="op">=</span> value</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._value</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> C(B):</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    _value:<span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> C()</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>c.ar.to_app(app)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/value'</span>).text, <span class="st">'3'</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/value?value=7'</span>).text, <span class="st">'7'</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>test_eq(c.value(), <span class="dv">7</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="adding-routes-to-the-app" class="level1">
<h1>Adding routes to the app</h1>
<blockquote class="blockquote">
<p>Convenience functions for registering routes from providers into FastHTML apps.</p>
</blockquote>
<section id="fasthtml-notebooks-scope-state" class="level2">
<h2 class="anchored" data-anchor-id="fasthtml-notebooks-scope-state">FastHTML, Notebooks, Scope &amp; State</h2>
<blockquote class="blockquote">
<p>Current <code>APIRouter</code> incarnation has a complicated relationship with scope and state.</p>
</blockquote>
<div id="cell-69" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> noelmeter(n): <span class="cf">return</span> <span class="ss">f"Ho </span><span class="sc">{</span>(<span class="st">'ho '</span><span class="op">*</span>n)<span class="sc">.</span>strip()<span class="sc">}</span><span class="ss">!"</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>ar <span class="op">=</span> APIRouter()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> {<span class="st">'count'</span>: <span class="dv">1</span>}</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="at">@ar</span>(<span class="st">"/ho"</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ho(req):</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>noelmeter(state[<span class="st">'count'</span>])<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>ar<span class="sc">.</span>ho<span class="sc">.</span>to()<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>req<span class="sc">.</span>url_for(<span class="st">'ho'</span>)<span class="sc">}</span><span class="ss">"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that <code>ho</code> access globals <code>state</code> and <code>ar</code>.</p>
<div id="cell-71" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>app,cli,_ <span class="op">=</span> get_app()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>ar.to_app(app)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/ho', name='ho', methods=['GET', 'HEAD', 'POST'])]</code></pre>
</div>
</div>
<div id="cell-72" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/ho'</span>).text, <span class="st">'Ho ho! /ho http://nb/ho'</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'ho'</span>), <span class="st">'/ho'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now let´s create another APIRouter with a separate state.</p>
<div id="cell-74" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ar2 <span class="op">=</span> APIRouter(<span class="st">"/products"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>state2 <span class="op">=</span> {<span class="st">'count'</span>: <span class="dv">3</span>}</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="at">@ar2</span>(<span class="st">"/ho"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ho(req):</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>noelmeter(state2[<span class="st">'count'</span>])<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>ar2<span class="sc">.</span>ho<span class="sc">.</span>to()<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>req<span class="sc">.</span>url_for(<span class="st">'ho'</span>)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>ar2.to_app(app)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/ho', name='ho', methods=['GET', 'HEAD', 'POST']), Route(path='/products/ho', name='ho', methods=['GET', 'HEAD', 'POST'])]</code></pre>
</div>
</div>
<p>We must use <code>prefix</code> to preserve <code>ar</code> routes when adding the new ones.</p>
<div id="cell-76" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/ho'</span>).text, <span class="st">'Ho ho! /ho http://nb/ho'</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/products/ho'</span>).text, <span class="st">'Ho ho ho ho! /products/ho http://nb/ho'</span>)  <span class="co"># &lt;-- wrong</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'ho'</span>), <span class="st">'/ho'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Routes @ <code>/ho</code> and <code>/products/ho</code> got the same name so either app or req can’t use reverse URL lookup to get the correct path of <code>ar2.ho</code>.</p>
<p>We may need to add <code>ar2</code> to another app because both <code>ar</code> and <code>ar2</code> routes share names, and then install <code>app2</code> as a submount.</p>
<div id="cell-78" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>app.routes.clear()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ar.to_app(app)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>ar2 <span class="op">=</span> APIRouter()  <span class="co"># we can`t use prefix here</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="at">@ar2</span>(<span class="st">"/ho"</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ho(req):</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>noelmeter(state2[<span class="st">'count'</span>])<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>ar2<span class="sc">.</span>ho<span class="sc">.</span>to()<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>req<span class="sc">.</span>url_for(<span class="st">'ho'</span>)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>app2,cli2,_ <span class="op">=</span> get_app()</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>ar2.to_app(app2)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>app.routes.append(Mount(<span class="st">'/products'</span>, app2))</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/ho', name='ho', methods=['GET', 'HEAD', 'POST']), Mount(path='/products', name='', app=&lt;fasthtml.core.FastHTML object at 0x1482269c0&gt;)]
[Route(path='/ho', name='ho', methods=['GET', 'HEAD', 'POST'])]</code></pre>
</div>
</div>
<div id="cell-79" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/ho'</span>).text, <span class="st">'Ho ho! /ho http://nb/ho'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/products/ho'</span>).text, <span class="st">'Ho ho ho ho! /ho http://nb/ho'</span>)  <span class="co"># &lt;-- wrong</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'ho'</span>), <span class="st">'/ho'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Nope. We can´t rely on <code>req.url_for(...)</code> or <code>app.url_path_fpr(...)</code> unless we add another global dependency.</p>
<div id="cell-81" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>app.routes.clear()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ar.to_app(app)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>ar2 <span class="op">=</span> APIRouter()</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="at">@ar2</span>(<span class="st">"/ho"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ho(req):</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>noelmeter(state2[<span class="st">'count'</span>])<span class="sc">}</span><span class="ss"> /products</span><span class="sc">{</span>ar2<span class="sc">.</span>ho<span class="sc">.</span>to()<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>req<span class="sc">.</span>url_for(<span class="st">'products:ho'</span>)<span class="sc">}</span><span class="ss">"</span>  <span class="co"># or</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">#  f"{noelmeter(state2['count'])} {ar2.prefix}{ar2.ho.to()} {req.url_for('products:ho')}"</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>app2,cli2,_ <span class="op">=</span> get_app()</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>ar2.to_app(app2)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>app.routes.append(Mount(<span class="st">'/products'</span>, app2, name<span class="op">=</span><span class="st">'products'</span>))  <span class="co"># &lt;-- assume `ar2` mounted with the name `products`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-82" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/ho'</span>).text, <span class="st">'Ho ho! /ho http://nb/ho'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/products/ho'</span>).text, <span class="st">'Ho ho ho ho! /products/ho http://nb/products/ho'</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'ho'</span>), <span class="st">'/ho'</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'products:ho'</span>), <span class="st">'/products/ho'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The fix above finally works. But now not only <code>ho</code> depends on globals <code>ar2</code> and <code>state2</code>, also on knowledge of the mount route name.</p>
</section>
<section id="add_routes" class="level2">
<h2 class="anchored" data-anchor-id="add_routes">add_routes</h2>
<p>Besides support for methods, <a href="https://civvic.github.io/bridget/route_provider.html#apirouterc"><code>APIRouterC</code></a> also has features to ease adding/mounting <code>APIRouter</code>s.</p>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/routing.py#L320" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="mount" class="level3">
<h3 class="anchored" data-anchor-id="mount">mount</h3>
<blockquote class="blockquote">
<pre><code> mount (app:fasthtml.core.FastHTML,
        prov:fasthtml.core.APIRouter|__main__.RouteProviderP,
        path:str|None=None, name:str|None=None)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/civvic/bridget/blob/main/bridget/routing.py#L272" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="add_routes-1" class="level3">
<h3 class="anchored" data-anchor-id="add_routes-1">add_routes</h3>
<blockquote class="blockquote">
<pre><code> add_routes
             (prov:fasthtml.core.APIRouter|__main__.RouteProviderP|typing.
             Any, mount:bool=False, path:str|None=None,
             name:str|None=None, appcls:Callable=&lt;function nb_app&gt;)</code></pre>
</blockquote>
<p><em>Register provider routes</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>prov</td>
<td>fasthtml.core.APIRouter | <strong>main</strong>.RouteProviderP | typing.Any</td>
<td></td>
<td>APIRouterC or RouteProvider</td>
</tr>
<tr class="even">
<td>mount</td>
<td>bool</td>
<td>False</td>
<td>mount routes under <code>path</code>; if false will add routes under APIRouter prefix</td>
</tr>
<tr class="odd">
<td>path</td>
<td>str | None</td>
<td>None</td>
<td>if <a href="https://civvic.github.io/bridget/route_provider.html#mount"><code>mount</code></a>, submount path (or auto-generated based on <code>prov</code> class)</td>
</tr>
<tr class="even">
<td>name</td>
<td>str | None</td>
<td>None</td>
<td>if <a href="https://civvic.github.io/bridget/route_provider.html#mount"><code>mount</code></a>, name for submount (or auto-generated based on path)</td>
</tr>
<tr class="odd">
<td>appcls</td>
<td>Callable</td>
<td>nb_app</td>
<td>use FastHTML factory for submounts</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>APIRouter</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><a href="https://civvic.github.io/bridget/route_provider.html#add_routes"><code>add_routes</code></a> handles two scenarios: 1. <a href="https://civvic.github.io/bridget/route_provider.html#mount"><code>mount</code></a> is <code>False</code>. This is equivalent to <code>APIRouter.to_app</code>, the routes are available under <code>APIRuter.prefix</code>. 2. <a href="https://civvic.github.io/bridget/route_provider.html#mount"><code>mount</code></a> is <code>True</code>. The routes are mounted under <code>path</code> and are available under path/prefix.</p>
<p>App routes can be organized at two levels: 1. <strong>root Level</strong>: Global routes 2. <strong>Provider Level</strong>: Scoped routes defined by providers</p>
<p>This allows for clean organization of routes and natural encapsulation of component behavior directly in the notebook. This will be handy when we start defining ipywidgets like widgets with FastHTML.</p>
<p>Though I think it’s convenient, you don’t need to mount routes providers at all, add its routes directly to the root level app.</p>
<div id="cell-88" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ar <span class="op">=</span> APIRoute</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-89" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Counter(RouteProvider):</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, value:<span class="bu">int</span><span class="op">=</span><span class="dv">0</span>): <span class="va">self</span>._value <span class="op">=</span> value</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/value'</span>, name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_value(<span class="va">self</span>): </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._value  <span class="co"># `0` is not a valid FastHTML response</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/inc'</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> increment(<span class="va">self</span>, x:<span class="bu">int</span><span class="op">=</span><span class="dv">1</span>): </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._value <span class="op">+=</span> x</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_value()</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>app, cli, _ <span class="op">=</span> get_app()</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> Counter()</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>add_routes(app, counter)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/value'</span>).text, <span class="st">''</span>)</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/inc'</span>).text, <span class="st">'1'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Add routes to apps (notebook-level <code>app</code> above). Routes available under <code>{self.ar.prefix}/...</code> or <code>{self.ar.to()}/...</code></p>
<p><a href="https://civvic.github.io/bridget/route_provider.html#add_routes"><code>add_routes</code></a> returns the <code>APIRouter</code> used to define the routes.</p>
<div id="cell-91" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>counter2 <span class="op">=</span> Counter(<span class="dv">7</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>add_routes(app, counter2)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/value'</span>).text, <span class="st">'7'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="ss">f"</span><span class="sc">{</span>counter2<span class="sc">.</span>ar<span class="sc">.</span>to()<span class="sc">}</span><span class="ss">/value"</span>).text, <span class="st">'7'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Note, however, routes are bound to a given <code>Counter</code> instance. Existing routes will be overwritten if you add routes from another instance.</p>
<div id="cell-93" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>counter3 <span class="op">=</span> Counter(<span class="dv">17</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># car3 = add_routes(app, counter3, path='/counter', name='cnt')  # routes under /... and /counter/...</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>car3 <span class="op">=</span> add_routes(app, counter3, path<span class="op">=</span><span class="st">'/counter'</span>)  <span class="co"># routes under /... and /counter/...</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>test_is(counter3.ar, car3)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/inc'</span>).text, <span class="st">'8'</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(car3.get_value.to()).text, <span class="st">'17'</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/counter/inc'</span>).text, <span class="st">'18'</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'value'</span>), <span class="st">'/value'</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(car3.name(<span class="st">'value'</span>)), <span class="st">'/counter/value'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD']), Mount(path='/counter', name='counter', app=&lt;fasthtml.core.FastHTML object at 0x148226570&gt;)]
[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>You can add instance routes under different <code>path</code> prefix.</p>
<p>Note <a href="https://civvic.github.io/bridget/route_provider.html#add_routes"><code>add_routes</code></a> with <code>path</code> argument will auto generate a <code>name</code> for the route if not provided.</p>
<div id="cell-95" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>counter32 <span class="op">=</span> Counter(<span class="dv">177</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>car32<span class="op">=</span> add_routes(app, counter32, path<span class="op">=</span><span class="st">'/counter'</span>, name<span class="op">=</span><span class="st">'cnt'</span>)  <span class="co"># routes under /... and /counter/...</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(car32.get_value.to()).text, <span class="st">'177'</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/counter/inc'</span>).text, <span class="st">'178'</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(<span class="st">'value'</span>), <span class="st">'/value'</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(car32.name(<span class="st">'value'</span>)), <span class="st">'/counter/value'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD']), Mount(path='/counter', name='cnt', app=&lt;fasthtml.core.FastHTML object at 0x148226840&gt;)]
[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Use <a href="https://civvic.github.io/bridget/route_provider.html#mount"><code>mount</code></a> to submount APIRouters under class name (or <code>add_routes(..., mount=True, ...)</code>).</p>
<div id="cell-97" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>counter4 <span class="op">=</span> Counter(<span class="dv">23</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>car4 <span class="op">=</span> mount(app, counter4, <span class="st">'/counter'</span>, <span class="st">'counter'</span>)  <span class="co"># routes under /..., /counter/..., and /Counter/counter/...</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes[<span class="op">-</span><span class="dv">1</span>].routes)  <span class="co"># type: ignore</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/inc'</span>).text, <span class="st">'9'</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/counter/inc'</span>).text, <span class="st">'179'</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/Counter/counter/value'</span>).text, <span class="st">'23'</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/Counter/counter/inc'</span>).text, <span class="st">'24'</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(car4.get_value.to()).text, <span class="st">'24'</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="ss">f"</span><span class="sc">{</span>car4<span class="sc">.</span>to()<span class="sc">}</span><span class="ss">/value"</span>).text, <span class="st">'24'</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>test_eq(car4.name(<span class="st">'increment'</span>), <span class="st">'Counter:counter:increment'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD']), Mount(path='/counter', name='cnt', app=&lt;fasthtml.core.FastHTML object at 0x148226840&gt;), Mount(path='/Counter', name='Counter', app=&lt;fasthtml.core.FastHTML object at 0x14823f440&gt;)]
[Mount(path='/counter', name='counter', app=&lt;fasthtml.core.FastHTML object at 0x14823e510&gt;)]
[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Mount with explicit path.<br>
An APIRouterC from an instance, discloses its mounted name with <code>self.ar.name()</code>.</p>
<div id="cell-99" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>counter5 <span class="op">=</span> Counter(<span class="op">-</span><span class="dv">7</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>car5 <span class="op">=</span> mount(app, counter5)  <span class="co"># routes under /counter/..., and root.</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes[<span class="op">-</span><span class="dv">1</span>].routes)  <span class="co"># type: ignore</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="ss">f"</span><span class="sc">{</span>car5<span class="sc">.</span>to()<span class="sc">}</span><span class="ss">/value"</span>).text, <span class="st">'-7'</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="ss">f"</span><span class="sc">{</span>car5<span class="sc">.</span>increment<span class="sc">.</span>to()<span class="sc">}</span><span class="ss">"</span>).text, <span class="st">'-6'</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(car5.to(<span class="st">'increment'</span>)).text, <span class="st">'-5'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD']), Mount(path='/counter', name='cnt', app=&lt;fasthtml.core.FastHTML object at 0x148226840&gt;), Mount(path='/Counter', name='Counter', app=&lt;fasthtml.core.FastHTML object at 0x14823f440&gt;)]
[Mount(path='/counter', name='counter', app=&lt;fasthtml.core.FastHTML object at 0x14823e510&gt;), Mount(path='/Counter_1-1764770681', name='Counter_1-1764770681', app=&lt;fasthtml.core.FastHTML object at 0x1482609b0&gt;)]
[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Mount routes with automatic path generation.</p>
<div id="cell-101" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>counter6 <span class="op">=</span> Counter(<span class="dv">111</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>car6 <span class="op">=</span> mount(app, counter6, path<span class="op">=</span><span class="st">'/'</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="ss">f"</span><span class="sc">{</span>car6<span class="sc">.</span>prefix<span class="sc">}</span><span class="ss">/value"</span>).text, <span class="st">'111'</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(car6.to(<span class="st">'increment'</span>)).text, <span class="st">'112'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD']), Mount(path='/counter', name='cnt', app=&lt;fasthtml.core.FastHTML object at 0x148226840&gt;), Mount(path='/Counter', name='Counter', app=&lt;fasthtml.core.FastHTML object at 0x14823f440&gt;)]
[Mount(path='/counter', name='counter', app=&lt;fasthtml.core.FastHTML object at 0x14823e510&gt;), Mount(path='/Counter_1-1764770681', name='Counter_1-1764770681', app=&lt;fasthtml.core.FastHTML object at 0x1482609b0&gt;), Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='increment', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p><code>counter_6</code> routes added at <code>Counter</code> submount as root routes.</p>
<p>Thus <a href="https://civvic.github.io/bridget/route_provider.html#add_routes"><code>add_routes</code></a> can be used to add routes to an app with instance-based routes: - mount=False, path=None =&gt; root-level routes (e.g.&nbsp;<code>/inc</code>). Equivalent to FastHTML <code>APIRouter.to_app</code> - mount=False, path=…: root-level subroutes (e.g.&nbsp;<code>/counter/inc</code>). Equivalent to FastHTML <code>APIRouter.to_app</code> + prefix - mount=True, path=None =&gt; auto routes scoped under class name (e.g.&nbsp;<code>/Counter/inc</code> ) - mount=True, path=… =&gt; auto routes scoped under class name and path (e.g.&nbsp;<code>/Counter/counter/inc</code> )</p>
</section>
</section>
</section>
<section id="route-introspection" class="level1">
<h1>Route introspection</h1>
<div id="cell-105" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Counter(RouteProvider):</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>): <span class="va">self</span>._value <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/value'</span>, name<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_value(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>: </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._value  <span class="co"># `0` (int(0)) is not a valid FastHTML response (will be converted to `''`)</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/inc'</span>, name<span class="op">=</span><span class="st">'inc'</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> increment(<span class="va">self</span>): </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._value <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_value()</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, x:<span class="bu">int</span>): </span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._value <span class="op">+=</span> x</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_value()</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar.post</span>(<span class="st">'/sub'</span>)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sub(<span class="va">self</span>, x:<span class="bu">int</span>): </span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._value <span class="op">-=</span> x</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_value()</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> link(<span class="va">self</span>, req): </span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>        nm <span class="op">=</span> <span class="va">self</span>.ar.name(<span class="st">'add'</span>)</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>        req.url_for(<span class="ss">f"</span><span class="sc">{</span>nm<span class="sc">}</span><span class="ss">"</span>, x<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (Div(<span class="st">'+ 3'</span>, link<span class="op">=</span>uri(nm, x<span class="op">=</span><span class="st">'3'</span>)), </span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>                Div(<span class="st">'+ 2'</span>, href<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>req<span class="sc">.</span>url_for(<span class="ss">f"</span><span class="sc">{</span>nm<span class="sc">}</span><span class="ss">"</span>, x<span class="op">=</span><span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>))</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Counter()</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>test_eq(c.increment(), <span class="dv">1</span>)</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>c.ar.to_app(app)</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.name(), <span class="st">''</span>)</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/inc'</span>).text, <span class="st">'2'</span>)</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/add/5'</span>).text, <span class="st">'7'</span>)</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/sub'</span>, data<span class="op">=</span>{<span class="st">'x'</span>:<span class="dv">2</span>}).text, <span class="st">'5'</span>)  <span class="co"># type: ignore</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>test_eq(cli.post(<span class="st">'/sub?x=3'</span>).text, <span class="st">'2'</span>)</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>test_eq(cli.get(<span class="st">'/link'</span>).text, <span class="st">' &lt;div href="/add/3"&gt;+ 3&lt;/div&gt;</span><span class="ch">\n</span><span class="st"> &lt;div href="http://nb/add/2"&gt;+ 2&lt;/div&gt;</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>test_eq(c.increment(), <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-106" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.increment.to(), <span class="st">'/inc'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.inc.to(), <span class="st">'/inc'</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.add.to(), <span class="st">'/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'add'</span>), <span class="st">'/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'sub'</span>, x<span class="op">=</span><span class="dv">3</span>), <span class="st">'/sub?x=3'</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'inc'</span>)), <span class="st">'/inc'</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'add'</span>), x<span class="op">=</span><span class="dv">5</span>), <span class="st">'/add/5'</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'sub'</span>)), <span class="st">'/sub'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-107" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Counter()</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>add_routes(app, c, path<span class="op">=</span><span class="st">'/counter'</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mount(app, c, '/counter')</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.prefix, <span class="st">'/counter'</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.add.to(), <span class="st">'/counter/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'increment'</span>), <span class="st">'/counter/inc'</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'inc'</span>), <span class="st">'/counter/inc'</span>)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'add'</span>), <span class="st">'/counter/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'sub'</span>, x<span class="op">=</span><span class="dv">3</span>), <span class="st">'/counter/sub?x=3'</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.name(<span class="st">'inc'</span>), <span class="ss">f"counter:inc"</span>)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'inc'</span>)), <span class="st">'/counter/inc'</span>)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'link'</span>)), <span class="st">'/counter/link'</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'add'</span>), x<span class="op">=</span><span class="dv">5</span>), <span class="st">'/counter/add/5'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Mount(path='/counter', name='counter', app=&lt;fasthtml.core.FastHTML object at 0x148213260&gt;)]
[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='inc', methods=['GET', 'HEAD']), Route(path='/add/{x}', name='add', methods=['GET', 'HEAD']), Route(path='/sub', name='sub', methods=['POST']), Route(path='/link', name='link', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<p>Above is equivalent <code>to_app</code> using a custom prefix. Mounting another instance at same path will override the routes.</p>
<div id="cell-109" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Counter()</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>mount(app, c, <span class="st">'/counter'</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes[<span class="op">-</span><span class="dv">1</span>].app.routes)  <span class="co"># type: ignore</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.prefix, <span class="st">'/Counter/counter'</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.add.to(), <span class="st">'/Counter/counter/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'increment'</span>), <span class="st">'/Counter/counter/inc'</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'add'</span>), <span class="st">'/Counter/counter/add/</span><span class="sc">{x}</span><span class="st">'</span>)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.to(<span class="st">'sub'</span>, x<span class="op">=</span><span class="dv">3</span>), <span class="st">'/Counter/counter/sub?x=3'</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'link'</span>)), <span class="st">'/Counter/counter/link'</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.name(<span class="st">'increment'</span>), <span class="ss">f"Counter:counter:inc"</span>)</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'inc'</span>)), <span class="st">'/Counter/counter/inc'</span>)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'add'</span>), x<span class="op">=</span><span class="dv">5</span>), <span class="st">'/Counter/counter/add/5'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[Mount(path='/Counter', name='Counter', app=&lt;fasthtml.core.FastHTML object at 0x1482245c0&gt;)]
[Mount(path='/counter', name='counter', app=&lt;fasthtml.core.FastHTML object at 0x148279730&gt;)]
[Route(path='/value', name='value', methods=['GET', 'HEAD']), Route(path='/inc', name='inc', methods=['GET', 'HEAD']), Route(path='/add/{x}', name='add', methods=['GET', 'HEAD']), Route(path='/sub', name='sub', methods=['POST']), Route(path='/link', name='link', methods=['GET', 'HEAD'])]</code></pre>
</div>
</div>
<div id="cell-110" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>app, cli, rt <span class="op">=</span> get_app()</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Counter()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>mount(app, c, <span class="st">'/counter'</span>, <span class="st">'cnt'</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'link'</span>)), <span class="st">'/Counter/counter/link'</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>test_eq(c.ar.name(<span class="st">'increment'</span>), <span class="ss">f"Counter:cnt:inc"</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'inc'</span>)), <span class="st">'/Counter/counter/inc'</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>test_eq(app.url_path_for(c.ar.name(<span class="st">'add'</span>), x<span class="op">=</span><span class="dv">5</span>), <span class="st">'/Counter/counter/add/5'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="examples" class="level1">
<h1>Examples</h1>
<div id="cell-112" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>bridge_cfg.auto_show <span class="op">=</span> <span class="va">True</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>show(DetailsJSON(bridge_cfg.as_dict()))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-113" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastHTML()</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>rt <span class="op">=</span> app.route</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>server <span class="op">=</span> JupyUviB(app)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

<script>
document.body.addEventListener('htmx:configRequest', (event) => {
    if(event.detail.path.includes('://')) return;
    htmx.config.selfRequestsOnly=false;
    event.detail.path = `http://0.0.0.0:8000${event.detail.path}`;
});
</script>
</div>
</div>
<div id="cell-114" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>render_ft()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-115" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>fh_cfg[<span class="st">'auto_id'</span>]<span class="op">=</span><span class="va">True</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>show(Script(src<span class="op">=</span><span class="st">'https://unpkg.com/htmx.org@2.0.4/dist/htmx.js'</span>), fhjsscr, scopesrc, surrsrc)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>clear_output()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-116" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>display(Javascript(<span class="st">'''</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="st">if (window.htmx) htmx.process(document.body);</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span>))</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>clear_output()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Below we define several hypothetical product related routes in a <code>Products</code> and then demonstrate how they can seamlessly be incorporated into a FastHTML app instance.</p>
<div id="cell-118" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Products:</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/all'</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> all_products(<span class="va">self</span>, req):</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Div(</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Welcome to the Products Page! Click the button below to look at the details for product 42"</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>            Div(</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                Button(</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Details'</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>                    hx_get<span class="op">=</span><span class="va">self</span>.ar.to(<span class="st">'details'</span>, pid<span class="op">=</span><span class="dv">42</span>),  <span class="co"># type: ignore</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>                    hx_target<span class="op">=</span><span class="st">'#products_list'</span>,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>                    hx_swap<span class="op">=</span><span class="st">'outerHTML'</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">id</span><span class="op">=</span><span class="st">'products_list'</span>,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@ar</span>(<span class="st">'/</span><span class="sc">{pid}</span><span class="st">'</span>, name<span class="op">=</span><span class="st">'details'</span>)  <span class="co"># or @ar('/{pid}') or @ar.get('/{pid}') or @ar.get('/{pid}', name='details')</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> details(<span class="va">self</span>, pid: <span class="bu">int</span>):</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Here are the product details for ID: </span><span class="sc">{</span>pid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>products <span class="op">=</span> Products()</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>add_routes(app, products, path<span class="op">=</span><span class="st">'/products'</span>, name<span class="op">=</span><span class="st">'products'</span>)</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>products.ar.all_products.to(), <span class="bu">str</span>(products.ar.rt_funcs.details)  <span class="co"># type: ignore</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>('/products/all', '/products/{pid}')</code></pre>
</div>
</div>
<p>Since we specified the <code>path='/products'</code> when mounting our hypothetical object, all routes defined in that provider will be found under <code>/products</code>.</p>
<div id="cell-120" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Div(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Click me for a look at our products"</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    hx_get<span class="op">=</span>products.ar.all_products,  <span class="co"># type: ignore</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    hx_swap<span class="op">=</span><span class="st">"outerHTML"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="_LZBI-RiJQYu8KqkiNIMc6A">
  <div hx-get="/products/all" hx-swap="outerHTML" id="_q2x2satfRI2WnYF_H0FJIg">Click me for a look at our products</div>
</div>
<script id="_G_e8N61SSXKgbcg-Kak78w">if (window.htmx) htmx.process(document.body)</script>
</div>
</div>
<p>Note how you can reference our python route functions via <code>APIRouter.rt_funcs</code> or <code>APIRouter.{name}</code> or <code>APIRouter.to('name')</code> in your <code>hx_{http_method}</code> calls like normal.</p>
<div id="cell-122" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>server.stop()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<!-- # Colophon -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/civvic\.github\.io\/bridget");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/civvic/bridget/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>