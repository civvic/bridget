# FastHTML patching


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

<!-- # Prologue -->

# FastHTML Bridge display

1.  This functionality patches FastHTML’s IPython display system
2.  This implementation:
    - Overrides all FT IPython MIME methods
    - Uses `bridge_cfg.auto_show` for display opt-in

This is a convenience and not core of this proof-of-concept notebooks.

``` python
fh_cfg['auto_id'] = False
bridge_cfg.auto_show = False
```

``` python
d = Div(style='color: red;', hx_trigger='click')(Text('Hi!'))
print(f"d: \n{d}"); display(Markdown('----'))
print(f"showtags(d): \n{showtags(d)}"); display(Markdown('----'))
display(Markdown(highlight(d)+'\n----'))
show(d)
```

    d: 
    <div hx-trigger="click" style="color: red;"><text>Hi!</text></div>

------------------------------------------------------------------------

    showtags(d): 
    <code><pre>
    &lt;div hx-trigger=&quot;click&quot; style=&quot;color: red;&quot;&gt;
    &lt;text&gt;Hi!&lt;/text&gt;&lt;/div&gt;

    </code></pre>

------------------------------------------------------------------------

``` html
<div hx-trigger="click" style="color: red;">
<text>Hi!</text></div>
```

------------------------------------------------------------------------

<div hx-trigger="click" style="color: red;">
<text>Hi!</text></div>

``` python
Div("I'm a Div!")
```

``` html
<div>I&#x27;m a Div!</div>
```

``` python
@FC.patch
def _repr_mimebundle_(self: FT, include=None, exclude=None):
    mb = {'text/plain': repr(self)}
    if bridge_cfg.auto_show: mb['text/html'] = self.__html__()
    else: mb['text/markdown'] = self._repr_markdown_()
    return mb
```

``` python
Div('me too!')
```

``` html
<div>me too!</div>
```

``` python
with bridge_cfg(auto_show=True):
    display(Div("But I'm prettier!"))
```

``` html
<div>But I&#x27;m prettier!</div>
```

``` python
Div('back to tags!')
```

``` html
<div>back to tags!</div>
```

``` python
bridge_cfg.auto_show = True
ft.Details(open=True)(ft.Summary('dddd'), ft.Pre('eeee'))
```

``` html
<details open><summary>dddd</summary><pre>eeee</pre></details>
```

``` python
with bridge_cfg(auto_show=False): display(ft.Button('ffff'))
ft.Button('ffff')
```

``` html
<button>ffff</button>
```

``` html
<button>ffff</button>
```

Revert to FT usual.

``` python
del FT._repr_mimebundle_  # type: ignore
```

``` python
Div("I'm a Div!")
```

``` html
<div>I&#x27;m a Div!</div>
```

# FastHTML Jupyter display

Opt-in to display FastHTML objects in the notebook as HTML instead of
the default markdown `repr`.

<div>

> **Warning**
>
> Note recent FastHTML
> [v0.9.0](https://github.com/AnswerDotAI/fasthtml/releases/tag/0.9.0)
> has improved Jupyter support substancially and now have this same
> functionality (with
> [`render_ft`](https://civvic.github.io/bridget/fasthtml_patching.html#render_ft),
> in v0.9.1 on by default).
>
> Unfortunately, current implementation doesn’t work in VSCode/Cursor
> and probably any other Jupyter-ish environment that sandbox notebook
> outputs.
>
> In VSCode/Cursor besides that,
> [`render_ft`](https://civvic.github.io/bridget/fasthtml_patching.html#render_ft)
> doesn’t work as expected, as Quarto renders markdown in a static
> shadow-root.

</div>

## Patching FastHTML jupyter to work in VSCode

------------------------------------------------------------------------

<a
href="https://github.com/civvic/bridget/blob/main/bridget/fasthtml_patching.py#L46"
target="_blank" style="float:right; font-size:smaller">source</a>

### JupyUviB

>  JupyUviB (app, log_level='error', host='0.0.0.0', port=8000, start=True,
>                **kwargs)

*Start and stop a Jupyter compatible uvicorn server with ASGI `app` on
`port` with `log_level`*

``` python
# type: ignore

app = FastHTML()
rt = app.route

@app.route
def index(): return 'hi'

port = 8000
server = JupyUviB(app, port=port)
```

<script>
document.body.addEventListener('htmx:configRequest', (event) => {
    if(event.detail.path.includes('://')) return;
    htmx.config.selfRequestsOnly=false;
    event.detail.path = `http://0.0.0.0:8000${event.detail.path}`;
});
</script>

``` python
get(f'http://localhost:{port}').text
```

    'hi'

``` python
fh_cfg['auto_id']=True
```

``` python
show(Script(src='https://unpkg.com/htmx.org@2.0.4/dist/htmx.js'), fhjsscr, scopesrc, surrsrc)
clear_output()  # so it doesn't import on notebook load
```

``` python
display(Javascript('''
if (window.htmx) htmx.process(document.body);
'''))
clear_output()
```

``` python
render_ft()
```

After importing `fasthtml.jupyter` and calling
[`render_ft()`](https://civvic.github.io/bridget/fasthtml_patching.html#render_ft),
FT components render directly in the notebook.

``` python
(c := Div('Cogito ergo sum'))
```

``` html
<div id="_dJUvZfBtTOWbxQFX_qLtaw">Cogito ergo sum</div>
```

Handlers are written just like a regular web app:

``` python
# type: ignore

@rt
def hoho(): return P('loaded!'), Div('hee hee', id=c, hx_swap_oob='true')
```

All the usual `hx_*` attributes can be used:

``` python
P('not loaded', hx_get=hoho, hx_trigger='load')  # type: ignore
```

``` html
<p hx-get="/hoho" hx-trigger="load" id="_me9jhFRjSkeYrB_qz6UKIw">not loaded</p>
```

FT components can be used directly both as `id` values and as
`hx_target` values.

``` python
(c := Div(''))
```

``` html
<div id="_loPtDUhZRrGjq77ARtd6jQ"></div>
```

``` python
# type: ignore

@rt
def foo(): return Div('foo bar')

P('hi', hx_get=foo, hx_trigger='load', hx_target=c)
```

``` html
<p hx-get="/foo" hx-trigger="load" hx-target="#_loPtDUhZRrGjq77ARtd6jQ" id="_T3nY9yJFRD2anqujr23j_w">hi</p>
```

## Stop server

``` python
server.stop()
```

------------------------------------------------------------------------

<!-- # Colophon -->
